import{a as c}from"./49.js";import{D as U}from"./40.js";import{A as n,T as a,Z as s,a as d,b as h,o as v,s as g,ua as o,zc as i}from"./32.js";var p=class t{token=o(null);isRefreshing=o(!1);static \u0275fac=function(e){return new(e||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})};var f=class t{decode(r){try{let e=atob(r),l=new Uint8Array(e.length);for(let u=0;u<e.length;u++)l[u]=e.charCodeAt(u);return new TextDecoder("utf-8").decode(l)}catch{return""}}static \u0275fac=function(e){return new(e||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})};var m=class t{http=s(U);authTokenStateService=s(p);base64Service=s(f);token=i(()=>this.authTokenStateService.token());searchUsers(r){return this.http.get(`${c.API_URL}/users/search`,{params:{name:r}}).pipe(n(e=>{throw console.error("Error searching users:",e.status),new Error("Failed to search users")}))}getUserData(){return this.token()?this.http.get(`${c.API_URL}/users/me`).pipe(n(e=>{throw console.error("Error fetching user data:",e.status),new Error("Failed to fetch user data")})):v(null)}getUserId(){return this.getUserData().pipe(g(r=>r?.id||""),n(()=>v("")))}getAnimals(){return this.http.get(`${c.API_URL}/animals`).pipe(n(r=>{throw console.error("Error fetching animals:",r.status),new Error("Failed to fetch animals")}))}getColors(){return this.http.get(`${c.API_URL}/colors`).pipe(n(r=>{throw console.error("Error fetching colors:",r.status),new Error("Failed to fetch colors")}))}getProfileByUserId(r){return this.http.get(`${c.API_URL}/profiles/${r}`).pipe(n(e=>{throw console.error("Error fetching profile by user ID:",e.status),new Error("Failed to fetch profile by user ID")}))}static \u0275fac=function(e){return new(e||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})};var b=class t{dataAccessService=s(m);authTokenStateService=s(p);base64Service=s(f);token=i(()=>this.authTokenStateService.token());user=o(null);animals=o([]);isDataLoading=o(!1);tokenAvatarUrl=o(null);tokenUserId=o(null);profile=i(()=>this.user()?.profile);avatarUrl=i(()=>this.user()?.avatarUrl||this.tokenAvatarUrl()||"");userId=i(()=>this.user()?.id||this.tokenUserId()||"");displayName=i(()=>this.profile()?.name||this.profile()?.email||"");setProfileFromToken(r){if(r){let e=JSON.parse(this.base64Service.decode(r.split(".")[1]));this.tokenAvatarUrl.set(e?.avatarUrl||null),this.tokenUserId.set(e?.sub||null)}}addAnimalsDataToState(r=[]){this.animals.set(r)}addUserDataToState(){this.user()||this.isDataLoading()||(this.isDataLoading.set(!0),this.dataAccessService.getUserData().subscribe({next:r=>{this.user.set(r)},error:()=>this.isDataLoading.set(!1),complete:()=>this.isDataLoading.set(!1)}))}updateUserAvatar(r){let e=this.user();if(e){let l=h(d({},e),{avatarUrl:r});this.user.set(l)}}updateUserProfile(r){let e=this.user();if(e&&e.profile){let l=h(d({},e),{profile:d(d({},e.profile),r)});this.user.set(l)}}static \u0275fac=function(e){return new(e||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})};export{p as a,m as b,b as c};
