import{E as I,Ma as p}from"./chunk-XQ2JBN3L.js";import{B as a,S as s,Y as n,a as c,b as d,o as u,t as h,ta as o,uc as i}from"./chunk-KQHS7NYU.js";var l=class t{token=o(null);static \u0275fac=function(r){return new(r||t)};static \u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"})};var f=class t{http=n(I);authTokenStateService=n(l);token=i(()=>this.authTokenStateService.token());getUserData(){let e=this.token();if(!e)return u(null);let m=JSON.parse(atob(e.split(".")[1])).username;return this.http.get(`${p.API_URL}/users/${m}`).pipe(a(b=>{throw console.error("Error fetching user data:",b.status),new Error("Failed to fetch user data")}))}getUserId(){return this.getUserData().pipe(h(e=>e?.id||""),a(()=>u("")))}getAnimals(){return this.http.get(`${p.API_URL}/animals`).pipe(a(e=>{throw console.error("Error fetching animals:",e.status),new Error("Failed to fetch animals")}))}getColors(){return this.http.get(`${p.API_URL}/colors`).pipe(a(e=>{throw console.error("Error fetching colors:",e.status),new Error("Failed to fetch colors")}))}getProfileByUserId(e){return this.http.get(`${p.API_URL}/profiles/${e}`).pipe(a(r=>{throw console.error("Error fetching profile by user ID:",r.status),new Error("Failed to fetch profile by user ID")}))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"})};var g=class t{dataAccessService=n(f);authTokenStateService=n(l);token=i(()=>this.authTokenStateService.token());user=o(null);animals=o([]);isDataLoading=o(!1);tokenProfile=o(null);profile=i(()=>this.user()?.profile||this.tokenProfile());avatarUrl=i(()=>this.profile()?.avatarUrl||null);displayName=i(()=>this.profile()?.name||this.profile()?.email||"");setProfileFromToken(e){if(e){let r=JSON.parse(atob(e.split(".")[1]));this.tokenProfile.set(r.profile||null)}}addAnimalsDataToState(e=[]){this.animals.set(e)}addUserDataToState(){this.user()||this.isDataLoading()||(this.isDataLoading.set(!0),this.dataAccessService.getUserData().subscribe({next:e=>{this.user.set(e)},error:()=>this.isDataLoading.set(!1),complete:()=>this.isDataLoading.set(!1)}))}updateUserProfile(e){let r=this.user();if(r&&r.profile){let m=d(c({},r),{profile:c(c({},r.profile),e)});this.user.set(m)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=s({token:t,factory:t.\u0275fac,providedIn:"root"})};export{l as a,f as b,g as c};
