import{a as l,c as S}from"./chunk-6MQV2VAN.js";import{a,b as u}from"./chunk-QAMDGSRR.js";import{f as h}from"./chunk-AYKO6O3P.js";import{c as f}from"./chunk-HKJ7WQY3.js";import{C as g,Ka as v}from"./chunk-ZLFWUQLM.js";import{T as c,Z as i,ia as p,ua as d,xc as m}from"./chunk-FGD53Q7F.js";var s=class{http=i(g);messageService=i(u);isLoading=d(!1);makeAuthRequest(e,t,o,n,L=!0){this.isLoading.set(!0),this.http.post(`${v.API_URL}${e}`,t).subscribe({next:k=>{o(k),L&&this.isLoading.set(!1)},error:()=>{n(),this.isLoading.set(!1)}})}handleSuccess(e,t){e&&this.messageService.sendMessage(e),t&&t()}handleError(e){e&&this.messageService.sendMessage(e)}};var I=class r extends s{router=i(h);stateService=i(f);authTokenService=i(S);fingerprintService=i(l);isLoggedIn=m(()=>this.authTokenService.isLoggedIn());getFingerprint(){return this.fingerprintService.getFingerprint()}request({email:e,password:t}){let o=this.getFingerprint();this.makeAuthRequest("/auth/login",{username:e,password:t,fingerprint:o},n=>this.onLoginSuccess(n),()=>this.handleError(a.LOGIN_FAILED),!1)}onLoginSuccess(e){this.authTokenService.isLoggedIn.set(!0);try{e?.access_token&&window.localStorage.setItem("token",e.access_token)}catch{this.messageService.sendMessage(a.STORAGE_ERROR)}this.handleSuccess(null,()=>{setTimeout(()=>{this.router.navigate(["/home"]),this.isLoading.set(!1)},800)})}logout(){this.authTokenService.logout()}static \u0275fac=(()=>{let e;return function(o){return(e||(e=p(r)))(o||r)}})();static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};export{s as a,I as b};
