import{a as D,c as G}from"./chunk-D2SEPQ6Z.js";import{b as W}from"./chunk-W5QWVDB3.js";import"./chunk-FD6NTXT2.js";import"./chunk-QOILXPNI.js";import{c as b,f as H,g as z,h,j as $,l as B,p as J}from"./chunk-LPZJUDW5.js";import"./chunk-67YJPA2C.js";import"./chunk-VJN423GF.js";import"./chunk-6NWKXNQR.js";import{e as K,f as Q}from"./chunk-FIHAXYSE.js";import"./chunk-MHTDVVDV.js";import"./chunk-F2X3VGZZ.js";import{B as O,C as q,Ka as M,m as N}from"./chunk-3E3OHC6J.js";import{Bb as a,Cb as l,Db as f,F as A,Hb as R,Lb as C,Mb as y,N as S,Qa as P,T as w,Ua as o,Vb as j,Wb as p,Xb as I,Y as T,Yb as U,Z as c,fa as u,fb as k,ga as g,kb as V,rb as r,ua as E,xc as L}from"./chunk-FGD53Q7F.js";var v=class i{constructor(t){this.http=t}getPresignedUrl(t){return this.http.post(`${M.API_URL}/uploads/signed-url`,t)}uploadFileToS3(t,e){return this.http.put(t,e,{reportProgress:!0,observe:"events"})}deleteFile(t){let e=encodeURIComponent(t);return this.http.delete(`${M.API_URL}/uploads/${e}`)}static \u0275fac=function(e){return new(e||i)(T(q))};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};var F=(e=>(e.MALE="male",e.FEMALE="female",e))(F||{});function Z(i,t){if(i&1&&(a(0,"div"),f(1,"progress",11),p(2),l()),i&2){let e=y();o(),r("value",e.uploadProgress),o(),U(" ",e.uploadProgress,"% ")}}function ee(i,t){if(i&1&&(a(0,"div")(1,"h3"),p(2,"Upload Complete!"),l(),f(3,"img",12),a(4,"p"),p(5," Image URL: "),a(6,"a",13),p(7),l()()()),i&2){let e=y();o(3),r("src",e.uploadedImageUrl,P),o(3),r("href",e.uploadedImageUrl,P),o(),I(e.uploadedImageUrl)}}function te(i,t){if(i&1&&(a(0,"div")(1,"p",14),p(2),l()()),i&2){let e=y();o(2),U("Error: ",e.error,"")}}var X=class i{selectedFile=null;isUploading=!1;uploadProgress=0;uploadedImageUrl=null;publicUrl=null;error=null;stateService=c(G);uploadService=c(v);dataAccessService=c(D);animals=L(()=>this.stateService.animals());colors=E([]);adminForm=new z({selectedAnimal:new h(null,[b.required]),selectedColor:new h(null,[b.required]),entityType:new h(null,[b.required])});get selectedAnimalControl(){return this.adminForm.get("selectedAnimal")}get selectedColorControl(){return this.adminForm.get("selectedColor")}get entityTypeControl(){return this.adminForm.get("entityType")}entityTypeOptions=Object.values(F).map(t=>({name:t.charAt(0).toUpperCase()+t.slice(1),value:t}));ngOnInit(){this.dataAccessService.getColors().subscribe(t=>{this.colors.set(t)})}onFileSelected(t){let e=t.target;e.files&&e.files[0]&&(this.selectedFile=e.files[0],this.uploadedImageUrl=null,this.uploadProgress=0,this.error=null)}onUpload(){if(!this.selectedFile||this.adminForm.invalid){this.adminForm.markAllAsTouched();return}let t=this.selectedAnimalControl.value,e=this.selectedColorControl.value,n=this.entityTypeControl.value,s=this.animals().find(d=>d.id===t),m=(s?s[n]:[]).find(d=>d.colorId===e)||null;this.isUploading=!0,this.error=null;let x=this.selectedFile;this.uploadService.getPresignedUrl({filename:x.name,contentType:x.type,entityType:n,entityId:m?.id||0}).pipe(S(d=>(this.publicUrl=d.publicUrl,this.uploadService.uploadFileToS3(d.uploadUrl,x))),A(()=>this.isUploading=!1)).subscribe(d=>{d.type===O.UploadProgress?this.uploadProgress=Math.round(100*(d.loaded/d.total)):d.type===O.Response&&(this.uploadedImageUrl=this.publicUrl)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-admin"]],decls:19,vars:15,consts:[["fileInput",""],[1,"admin-container"],[1,"admin-form",3,"formGroup"],["type","select","label","Select Animal","placeholder","Choose an animal","optionValue","id",3,"control","options"],["type","select","label","Select Color","placeholder","Choose a color","optionValue","id",3,"control","options"],["type","select","label","Entity Type","placeholder","Choose entity type","optionValue","value",3,"control","options"],[1,"upload-section"],["icon","pi pi-upload","severity","secondary",3,"onClick","label"],["type","file","accept","image/*",2,"display","none",3,"change"],[3,"onClick","label","disabled","loading"],[4,"ngIf"],["max","100",3,"value"],["alt","Uploaded Image","width","300",3,"src"],["target","_blank",3,"href"],[2,"color","red"]],template:function(e,n){if(e&1){let s=R();a(0,"div",1)(1,"form",2)(2,"h2"),p(3,"Admin Panel"),l(),f(4,"app-form-control",3)(5,"app-form-control",4)(6,"app-form-control",5),l(),a(7,"div",6)(8,"h3"),p(9,"File Upload"),l(),a(10,"p-button",7),C("onClick",function(){u(s);let m=j(12);return g(m.click())}),l(),a(11,"input",8,0),C("change",function(m){return u(s),g(n.onFileSelected(m))}),l(),a(13,"div"),p(14),l(),a(15,"p-button",9),C("onClick",function(){return u(s),g(n.onUpload())}),l(),V(16,Z,3,2,"div",10)(17,ee,8,3,"div",10)(18,te,3,1,"div",10),l()()}e&2&&(o(),r("formGroup",n.adminForm),o(3),r("control",n.selectedAnimalControl)("options",n.animals()),o(),r("control",n.selectedColorControl)("options",n.colors()),o(),r("control",n.entityTypeControl)("options",n.entityTypeOptions),o(4),r("label","Choose"),o(4),I(n.selectedFile==null?null:n.selectedFile.name),o(),r("label","Upload")("disabled",!n.selectedFile||n.isUploading||n.adminForm.invalid)("loading",n.isUploading),o(),r("ngIf",n.uploadProgress>0),o(),r("ngIf",n.uploadedImageUrl),o(),r("ngIf",n.error))},dependencies:[N,J,$,H,B,W,Q,K],styles:[".admin-container[_ngcontent-%COMP%]{padding:80px 40px 0;display:flex;flex-direction:column;align-items:flex-end;justify-content:flex-start;gap:20px}.admin-container[_ngcontent-%COMP%]   .admin-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:100%;max-width:400px;background:#18181b6b;border:1px solid #dfe7ef;border-radius:8px;padding:40px;box-shadow:0 8px 32px #0000004d}.admin-container[_ngcontent-%COMP%]   .admin-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem;color:#34f5dd}.admin-container[_ngcontent-%COMP%]   .upload-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:100%;max-width:400px;background:#18181b6b;border:1px solid #dfe7ef;border-radius:8px;padding:40px;box-shadow:0 8px 32px #0000004d}.admin-container[_ngcontent-%COMP%]   .upload-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#34f5dd}.admin-container[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{margin-bottom:10px}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;padding:.5rem 1rem;border:none;border-radius:4px;background-color:#007bff;color:#fff;cursor:pointer}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.admin-container[_ngcontent-%COMP%]   progress[_ngcontent-%COMP%]{width:100%;margin-top:10px}.admin-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .admin-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:10px}.admin-container[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;margin-top:10px}@media (max-width: 960px){.admin-container[_ngcontent-%COMP%]{padding:80px 8px 0;align-items:center}}[_nghost-%COMP%]     .p-select.ng-invalid.ng-touched{border:1px solid rgba(255,0,68,.6666666667)!important;border-radius:6px;box-shadow:none}"]})};export{X as AdminComponent};
