import{C as g,Ma as p}from"./chunk-AAJBQ4S2.js";import{A as s,T as o,Z as a,a as d,b as v,o as h,s as b,ua as i,xc as n}from"./chunk-RFBIJB72.js";var f=class t{token=i(null);isRefreshing=i(!1);static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};var m=class t{decode(e){try{let r=atob(e),l=new Uint8Array(r.length);for(let c=0;c<r.length;c++)l[c]=r.charCodeAt(c);return new TextDecoder("utf-8").decode(l)}catch{return""}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};var u=class t{http=a(g);authTokenStateService=a(f);base64Service=a(m);token=n(()=>this.authTokenStateService.token());searchUsers(e){return this.http.get(`${p.API_URL}/users/search`,{params:{name:e}}).pipe(s(r=>{throw console.error("Error searching users:",r.status),new Error("Failed to search users")}))}getUserData(){let e=this.token();if(!e)return h(null);let l=JSON.parse(this.base64Service.decode(e.split(".")[1])).username;return this.http.get(`${p.API_URL}/users/${l}`).pipe(s(c=>{throw console.error("Error fetching user data:",c.status),new Error("Failed to fetch user data")}))}getUserId(){return this.getUserData().pipe(b(e=>e?.id||""),s(()=>h("")))}getAnimals(){return this.http.get(`${p.API_URL}/animals`).pipe(s(e=>{throw console.error("Error fetching animals:",e.status),new Error("Failed to fetch animals")}))}getColors(){return this.http.get(`${p.API_URL}/colors`).pipe(s(e=>{throw console.error("Error fetching colors:",e.status),new Error("Failed to fetch colors")}))}getProfileByUserId(e){return this.http.get(`${p.API_URL}/profiles/${e}`).pipe(s(r=>{throw console.error("Error fetching profile by user ID:",r.status),new Error("Failed to fetch profile by user ID")}))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};var y=class t{dataAccessService=a(u);authTokenStateService=a(f);base64Service=a(m);token=n(()=>this.authTokenStateService.token());user=i(null);animals=i([]);isDataLoading=i(!1);tokenProfile=i(null);profile=n(()=>this.user()?.profile||this.tokenProfile());avatarUrl=n(()=>this.profile()?.avatarUrl||null);displayName=n(()=>this.profile()?.name||this.profile()?.email||"");setProfileFromToken(e){if(e){let r=JSON.parse(this.base64Service.decode(e.split(".")[1]));this.tokenProfile.set(r.profile||null)}}addAnimalsDataToState(e=[]){this.animals.set(e)}addUserDataToState(){this.user()||this.isDataLoading()||(this.isDataLoading.set(!0),this.dataAccessService.getUserData().subscribe({next:e=>{this.user.set(e)},error:()=>this.isDataLoading.set(!1),complete:()=>this.isDataLoading.set(!1)}))}updateUserProfile(e){let r=this.user();if(r&&r.profile){let l=v(d({},r),{profile:d(d({},r.profile),e)});this.user.set(l)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};export{f as a,u as b,y as c};
