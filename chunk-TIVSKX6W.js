import{a as G,b as H}from"./chunk-6SMLIDGQ.js";import{b as V}from"./chunk-3O3D2GIQ.js";import"./chunk-OSCRORKM.js";import{c as F}from"./chunk-N5HVNUXB.js";import"./chunk-PIVKBQQN.js";import{a as q}from"./chunk-6GQ77XIH.js";import{f as A}from"./chunk-K5BU6CYA.js";import{b as R}from"./chunk-65LKHUET.js";import"./chunk-6C2J5BQ3.js";import"./chunk-APZXJAS2.js";import{d as L,e as j,f as N}from"./chunk-MAXMR2XW.js";import{c as $,d as z}from"./chunk-FA5VPBIA.js";import{c as B}from"./chunk-ZEQNEQPC.js";import{l as E,m as U}from"./chunk-ZXNNLAB3.js";import{Ab as x,Eb as k,Ib as T,Jb as l,N as b,Ra as i,Tb as c,Ub as g,Vb as O,Wb as D,X as f,cb as y,da as u,ea as v,fc as _,gc as C,hb as p,k as w,ob as m,qb as S,tc as h,ub as I,yb as a,zb as o}from"./chunk-QP7WRVZV.js";function K(n,t){n&1&&(a(0,"div",1),x(1,"app-loader"),o())}function Q(n,t){if(n&1&&(a(0,"div",19),c(1),o()),n&2){let e=l().$implicit;i(),g(e.profile.name)}}function W(n,t){if(n&1&&(a(0,"div",20),c(1),o()),n&2){let e=l().$implicit;i(),O(" ",e.unreadCount," ")}}function X(n,t){if(n&1){let e=k();a(0,"div",8),T("click",function(){let d=u(e).$implicit,s=l(2);return v(s.openChat(d.userId))})("keydown.enter",function(){let d=u(e).$implicit,s=l(2);return v(s.openChat(d.userId))})("keydown.space",function(){let d=u(e).$implicit,s=l(2);return v(s.openChat(d.userId))}),a(1,"div",9),x(2,"app-chat-avatar",10)(3,"app-online-status",11),o(),a(4,"div",12)(5,"div",13),p(6,Q,2,1,"div",14),a(7,"div",15),c(8),o()(),a(9,"div",16)(10,"span",17),c(11),o(),p(12,W,2,1,"div",18),o()()()}if(n&2){let e=t.$implicit,r=l(2);S("has-unread",e.unreadCount&&e.unreadCount>0),i(2),m("profile",e.profile),i(),m("isOnline",e.isOnline),i(3),m("ngIf",e.profile==null?null:e.profile.name),i(2),O(" ",r.formatLastMessageTime(e.lastMessageAt)," "),i(3),g(e.lastMessage),i(),m("ngIf",e.unreadCount&&e.unreadCount>0)}}function Y(n,t){n&1&&(a(0,"div",21)(1,"div",22),c(2,"\u{1F4AC}"),o(),a(3,"h3"),c(4),_(5,"translate"),o(),a(6,"p"),c(7),_(8,"translate"),o()()),n&2&&(i(4),g(C(5,2,"No conversations yet")),i(3),g(C(8,4,"Start a new conversation to see it here")))}function Z(n,t){if(n&1&&(a(0,"div",2)(1,"h2",3),c(2),_(3,"translate"),o(),a(4,"div",4),c(5),_(6,"translate"),o()(),a(7,"div",5),p(8,X,13,8,"div",6),o(),p(9,Y,9,6,"div",7)),n&2){let e=l();i(2),g(C(3,6,"Messages")),i(3),D("",e.interlocutors().length," ",C(6,8,"conversations"),""),i(3),m("ngForOf",e.interlocutors())("ngForTrackBy",e.trackByFn),i(),m("ngIf",e.interlocutors().length===0)}}var J=class n{chatStateService=f(F);chats=h(()=>this.chatStateService.chats());chatService=f(V);stateService=f(B);router=f(A);currentUserProfile=h(()=>this.stateService.profile());currentUserId=h(()=>this.currentUserProfile()?.userId||"");destroy$=new w;isChatsLoading=h(()=>this.chatService.isChatsLoading());interlocutors=h(()=>this.chats()?this.chats()?.map(t=>{console.log("chat",this.currentUserId());let e=t.participant1Id===Number(this.currentUserId())?t.participant2:t.participant1;return{id:e?.id||"",chatId:t.id,userId:e?.id||"",isOnline:e?.isOnline||!1,profile:e?.profile||null,lastMessageAt:t.lastMessageAt,lastMessage:t.messages[0]?.content||"",unreadCount:this.getUnreadCount(t)}}).sort((t,e)=>{let r=t.lastMessageAt?new Date(t.lastMessageAt).getTime():0;return(e.lastMessageAt?new Date(e.lastMessageAt).getTime():0)-r}):[]);constructor(){this.chatService.onConnect().pipe(b(this.destroy$)).subscribe(()=>{this.connectToUserChats()})}ngOnInit(){this.chatService.isChatsLoading.set(!0),this.chatService.isConnected()&&this.connectToUserChats()}connectToUserChats(){if(console.log("Connecting to user chats",this.chats()),this.chats()){this.chatService.isChatsLoading.set(!1);return}this.chatService.getUserChats()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}trackByFn(t,e){return e.chatId}openChat(t){this.router.navigate(["chat",t])}getUnreadCount(t){return this.chatStateService.getUnreadCount(t)}formatLastMessageTime(t){if(!t)return"";let e=new Date,r=new Date(t),d=e.getTime()-r.getTime(),s=Math.floor(d/(1e3*60)),M=Math.floor(s/60),P=Math.floor(M/24);return s<1?"Now":s<60?`${s}m`:M<24?`${M}h`:P<7?`${P}d`:r.toLocaleDateString()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["app-messages"]],decls:3,vars:1,consts:[[1,"messages-container"],[1,"loader-container"],[1,"messages-header"],[1,"messages-title"],[1,"messages-count"],[1,"chat-list"],["class","chat-item","pRipple","","tabindex","0","role","button",3,"has-unread","click","keydown.enter","keydown.space",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],["pRipple","","tabindex","0","role","button",1,"chat-item",3,"click","keydown.enter","keydown.space"],[1,"avatar-container"],[3,"profile"],[1,"status-indicator",3,"isOnline"],[1,"chat-content"],[1,"chat-header"],["class","chat-name",4,"ngIf"],[1,"chat-time"],[1,"chat-preview"],[1,"last-message"],["class","unread-badge",4,"ngIf"],[1,"chat-name"],[1,"unread-badge"],[1,"empty-state"],[1,"empty-icon"]],template:function(e,r){e&1&&(a(0,"div",0),p(1,K,2,0,"div",1)(2,Z,10,10),o()),e&2&&(i(),I(r.isChatsLoading()?1:2))},dependencies:[E,U,R,N,j,L,G,H,q,z,$],styles:['.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff1a;border-radius:3px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#ffffff4d;border-radius:3px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#ffffff80}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%], .chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-weight:600}[_nghost-%COMP%]{display:flex;width:100%;justify-content:flex-end}@media (max-width: 800px){[_nghost-%COMP%]{justify-content:center}[_nghost-%COMP%]   .messages-container[_ngcontent-%COMP%]{right:0;max-width:100%}}.messages-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background:#18181bcc;color:#fff;overflow:hidden;position:relative;top:92px;right:2rem;width:320px;border:1px solid rgba(52,245,221,.2);border-radius:1.5rem}.messages-container[_ngcontent-%COMP%]   .loader-container[_ngcontent-%COMP%]{padding:20px}.messages-header[_ngcontent-%COMP%]{padding:1.5rem 1rem 1rem;border-bottom:1px solid rgba(52,245,221,.1);background:linear-gradient(135deg,rgba(52,245,221,.05) 0%,transparent 100%)}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%]{font-size:1.5rem;margin:0 0 .5rem;font-weight:700}.messages-header[_ngcontent-%COMP%]   .messages-count[_ngcontent-%COMP%]{color:#fff9;font-size:.875rem;font-weight:400}.messages-header[_ngcontent-%COMP%]   .messages-count[_ngcontent-%COMP%]   .unread-indicator[_ngcontent-%COMP%]{color:#34f5dd;font-weight:600}.chat-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;max-height:50vh;max-height:50dvh;padding:.5rem 0 1.5rem}.chat-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem;cursor:pointer;transition:all .2s ease-in-out;border-bottom:1px solid rgba(52,245,221,.05);position:relative}.chat-item[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;bottom:0;width:0;background:#34f5dd;transition:width .2s ease-in-out}.chat-item[_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#34f5dd14,#34f5dd08)}.chat-item[_ngcontent-%COMP%]:hover:before{width:3px}.chat-item.has-unread[_ngcontent-%COMP%]{background:linear-gradient(90deg,#34f5dd1f,#34f5dd0d)}.chat-item.has-unread[_ngcontent-%COMP%]:before{width:3px}.chat-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.avatar-container[_ngcontent-%COMP%]{position:relative;flex-shrink:0}.avatar-container[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{position:absolute;bottom:2px;right:2px;z-index:1}.chat-content[_ngcontent-%COMP%]{flex:1;min-width:0;margin-left:14px}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-time[_ngcontent-%COMP%]{color:#ffffff80;font-size:.75rem;font-weight:400;flex-shrink:0}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .last-message[_ngcontent-%COMP%]{color:#ffffffb3;font-size:.875rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;margin-right:.5rem}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .unread-badge[_ngcontent-%COMP%]{background:#34f5dd;color:#000;font-size:.75rem;font-weight:600;padding:2px 6px;border-radius:10px;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;opacity:.7}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;margin:0 0 .5rem;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff9;margin:0;font-size:.875rem}@media (max-width: 768px){.messages-header[_ngcontent-%COMP%]{padding:1rem .75rem .75rem}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%]{font-size:1.25rem}.chat-item[_ngcontent-%COMP%]{padding:.75rem}.chat-item[_ngcontent-%COMP%]:hover{padding-left:calc(.75rem - 3px)}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-size:.9rem;max-width:65%}}']})};export{J as MessagesComponent};
