import{C as g,Ka as m}from"./chunk-ZXNNLAB3.js";import{A as c,R as o,X as i,a as d,b as I,o as h,s as b,sa as a,tc as s}from"./chunk-QP7WRVZV.js";var f=class t{token=a(null);isRefreshing=a(!1);static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};var p=class t{decode(e){try{let r=atob(e),n=new Uint8Array(r.length);for(let l=0;l<r.length;l++)n[l]=r.charCodeAt(l);return new TextDecoder("utf-8").decode(n)}catch{return""}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};var u=class t{http=i(g);authTokenStateService=i(f);base64Service=i(p);token=s(()=>this.authTokenStateService.token());getUserData(){let e=this.token();if(!e)return h(null);let n=JSON.parse(this.base64Service.decode(e.split(".")[1])).username;return this.http.get(`${m.API_URL}/users/${n}`).pipe(c(l=>{throw console.error("Error fetching user data:",l.status),new Error("Failed to fetch user data")}))}getUserId(){return this.getUserData().pipe(b(e=>e?.id||""),c(()=>h("")))}getAnimals(){return this.http.get(`${m.API_URL}/animals`).pipe(c(e=>{throw console.error("Error fetching animals:",e.status),new Error("Failed to fetch animals")}))}getColors(){return this.http.get(`${m.API_URL}/colors`).pipe(c(e=>{throw console.error("Error fetching colors:",e.status),new Error("Failed to fetch colors")}))}getProfileByUserId(e){return this.http.get(`${m.API_URL}/profiles/${e}`).pipe(c(r=>{throw console.error("Error fetching profile by user ID:",r.status),new Error("Failed to fetch profile by user ID")}))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};var y=class t{dataAccessService=i(u);authTokenStateService=i(f);base64Service=i(p);token=s(()=>this.authTokenStateService.token());user=a(null);animals=a([]);isDataLoading=a(!1);tokenProfile=a(null);profile=s(()=>this.user()?.profile||this.tokenProfile());avatarUrl=s(()=>this.profile()?.avatarUrl||null);displayName=s(()=>this.profile()?.name||this.profile()?.email||"");setProfileFromToken(e){if(e){let r=JSON.parse(this.base64Service.decode(e.split(".")[1]));this.tokenProfile.set(r.profile||null)}}addAnimalsDataToState(e=[]){this.animals.set(e)}addUserDataToState(){this.user()||this.isDataLoading()||(this.isDataLoading.set(!0),this.dataAccessService.getUserData().subscribe({next:e=>{this.user.set(e)},error:()=>this.isDataLoading.set(!1),complete:()=>this.isDataLoading.set(!1)}))}updateUserProfile(e){let r=this.user();if(r&&r.profile){let n=I(d({},r),{profile:d(d({},r.profile),e)});this.user.set(n)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})};export{f as a,u as b,y as c};
