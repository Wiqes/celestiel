import{c as H}from"./chunk-BWCUAARX.js";import{a as l}from"./chunk-AYKVXQHD.js";import{B as T}from"./chunk-XQ2JBN3L.js";import{B as a,N as h,Y as S,p,uc as k}from"./chunk-KQHS7NYU.js";var f=new T(()=>!1),w=(t,e)=>{let n=S(H),r=S(l),o=k(()=>r.token()||"RXVjYWVsIEluYy4=");return t.context.get(f)||t.url.includes("wiqes-images.s3.us-east-1.amazonaws.com")||t.url.includes("/auth/")?e(t):m({req:t,next:e,authTokenService:n,authTokenStateService:r,token:o()})};function m(t){let{req:e,next:n,authTokenService:r,authTokenStateService:o,token:u}=t;if(u&&r.isTokenExpiringSoon())return r.refreshToken().pipe(h(s=>{let v=c(e,s,o);return n(v)}),a(s=>n(c(e,null,o))));let i=c(e,u,o);return n(i).pipe(a(s=>{if(s.status===401){if(u)return R({req:e,next:n,authTokenService:r,authTokenStateService:o});r.moveToLogin()}return p(()=>s)}))}function R(t){let{req:e,next:n,authTokenService:r,authTokenStateService:o}=t;return r.refreshToken().pipe(h(u=>{let i=c(e,u,o);return n(i)}),a(u=>(r.moveToLogin(),p(()=>u))))}function c(t,e,n){return e&&n.token.set(e),t.clone({setHeaders:e?{Authorization:`Bearer ${e}`}:{}})}export{f as a,w as b};
