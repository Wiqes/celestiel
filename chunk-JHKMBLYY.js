import{a as it,b as nt}from"./chunk-RKSPUSOA.js";import{a as ne,b as oe}from"./chunk-6TIGTB77.js";import"./chunk-4OIULTP7.js";import{c as K}from"./chunk-X7J2GG3T.js";import{a as et}from"./chunk-QIJRUKEB.js";import"./chunk-6PCLXYXS.js";import{a as tt}from"./chunk-2DKR24BU.js";import{d as Ye}from"./chunk-VK6MDSNN.js";import"./chunk-PFDXCKEB.js";import"./chunk-XAN747VL.js";import"./chunk-E447OGXX.js";import{b as Ke,e as We,i as Ge,m as Xe,o as W}from"./chunk-ZEHJZ2GA.js";import"./chunk-7UHUAHRR.js";import"./chunk-GGQ7LRWG.js";import"./chunk-VM3EBWKM.js";import{c as Fe,d as de,f as Z,h as ge,i as ue,k as fe}from"./chunk-F2X3VGZZ.js";import{d as ee,e as te,f as ie}from"./chunk-KT3GIUQ7.js";import{e as G,f as X}from"./chunk-ZFTKZDZF.js";import"./chunk-MH56DLJT.js";import{b as Qe,c as V,d as w}from"./chunk-ZNEPEABM.js";import{a as Je,c as J}from"./chunk-3Z5XDCTO.js";import{Da as ze,Ea as $e,Fa as Y,Ga as _e,Ia as qe,La as Ze,V as A,j as Ue,l as Ae,la as He,m as O,r as Ne,t as S,wa as he,xa as R,ya as N}from"./chunk-AAJBQ4S2.js";import{Bb as p,Cb as m,Db as g,Gb as z,Hb as x,Lb as b,Mb as r,Nb as De,Ob as Be,P as Q,Pa as Se,Pb as I,Qb as L,Rb as _,Sb as C,T as ye,Ta as c,U as xe,Xb as E,Ya as pe,Yb as $,Z as u,Zb as me,cc as q,ec as je,fa as f,fb as y,ga as h,gb as Oe,gc as Ve,ia as Te,jb as we,jc as D,k as ve,kb as s,kc as B,mc as U,oa as j,pa as Me,qb as Pe,ra as Ie,rb as a,sa as P,tb as ke,ua as k,ub as Ee,uc as M,vb as H,vc as Re,xb as T,xc as v,yc as Le}from"./chunk-RFBIJB72.js";function ct(t,i){t&1&&(p(0,"div",1)(1,"div",2)(2,"span"),E(3),D(4,"translate"),m()(),p(5,"div",3),g(6,"div",4)(7,"div",4)(8,"div",4),m()()),t&2&&(c(3),$(B(4,1,"is typing")))}var ae=class t{isVisible=!1;static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-typing-indicator"]],inputs:{isVisible:"isVisible"},decls:1,vars:1,consts:[["class","typing-indicator",4,"ngIf"],[1,"typing-indicator"],[1,"typing-text"],[1,"typing-dots"],[1,"dot"]],template:function(e,o){e&1&&s(0,ct,9,3,"div",0),e&2&&a("ngIf",o.isVisible)},dependencies:[S,O,w,V],styles:[".typing-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:#34f5f5;border-radius:1rem;animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}.typing-text[_ngcontent-%COMP%]{font-style:italic}.typing-dots[_ngcontent-%COMP%]{display:flex;gap:.2rem;position:relative;top:4px;left:-2px}.dot[_ngcontent-%COMP%]{width:2px;height:2px;border-radius:50%;background-color:#34f5f5;animation:_ngcontent-%COMP%_pulse 1.4s infinite ease-in-out}.dot[_ngcontent-%COMP%]:nth-child(1){animation-delay:-.32s}.dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.16s}@keyframes _ngcontent-%COMP%_pulse{0%,80%,to{transform:scale(.5);opacity:.3}40%{transform:scale(1);opacity:1}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}"]})};var re=class t{isTyping=P(!1);isOnline=P(!1);interlocutorProfile=P(null);interlocutorName=v(()=>this.interlocutorProfile()?.name||this.interlocutorProfile()?.email||"Unknown");static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-chat-header"]],inputs:{isTyping:[1,"isTyping"],isOnline:[1,"isOnline"],interlocutorProfile:[1,"interlocutorProfile"]},decls:8,vars:4,consts:[[1,"header-avatar"],[3,"profile"],[1,"status-indicator",3,"isOnline"],[1,"header-info"],[1,"header-name"],[1,"header-status"],[3,"isVisible"]],template:function(e,o){e&1&&(p(0,"div",0),g(1,"app-chat-avatar",1)(2,"app-online-status",2),m(),p(3,"div",3)(4,"div",4),E(5),m(),p(6,"div",5),g(7,"app-typing-indicator",6),m()()),e&2&&(c(),a("profile",o.interlocutorProfile()),c(),a("isOnline",o.isOnline()),c(3),$(o.interlocutorName()),c(2),a("isVisible",o.isTyping()))},dependencies:[it,ae,nt],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:10px 15px;background:#18181b80;margin:0;border-bottom:1px solid rgba(52,245,221,.1);min-height:60px}[_nghost-%COMP%]   .header-avatar[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}[_nghost-%COMP%]   .header-avatar[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{position:absolute;bottom:2px;right:2px;z-index:1}[_nghost-%COMP%]   .header-info[_ngcontent-%COMP%]{margin-left:10px;flex-grow:1;display:flex;flex-direction:column;gap:2px}[_nghost-%COMP%]   .header-info[_ngcontent-%COMP%]   .header-name[_ngcontent-%COMP%]{font-weight:900;font-size:20px;line-height:1.2}[_nghost-%COMP%]   .header-info[_ngcontent-%COMP%]   .header-status[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color-secondary);font-weight:400}"]})};var pt=["messageInput"],le=class t{chatService=u(oe);chatStateService=u(K);stateService=u(J);interlocutorService=u(ne);myProfile=v(()=>this.stateService.profile()||null);currentUserId=v(()=>this.myProfile()?.userId||"");interlocutor=v(()=>this.interlocutorService.interlocutor()||null);interlocutorProfile=v(()=>this.interlocutor()?.profile||null);activeChatId=P("");receiverId=P("");messageSent=Ie();isTyping=k(!1);newMessageContent="";typingTimeout;previousMessageContent="";messageInput;ngOnInit(){this.newMessageContent=this.chatStateService.draftMessage(),this.previousMessageContent=this.newMessageContent}onSendButtonMouseDown(i){i.preventDefault()}onKeyPress(i){i.key==="Enter"&&(i.preventDefault(),this.sendMessage())}sendMessage(){if(console.log("Attempting to send message:",this.newMessageContent),this.newMessageContent.trim()&&this.currentUserId()&&this.receiverId()){let i=this.newMessageContent.trim();console.log("Sending message:",i),this.isTyping()&&(this.isTyping.set(!1),this.chatService.sendTypingIndicator(this.activeChatId(),!1),this.typingTimeout&&clearTimeout(this.typingTimeout)),this.newMessageContent="",this.previousMessageContent="",this.chatStateService.clearDraftMessage(),this.messageSent.emit({id:"",content:i,timestamp:new Date,sender:{id:this.currentUserId(),profile:this.myProfile()},receiver:{id:this.receiverId(),profile:this.interlocutorProfile()}}),this.chatService.sendMessage({content:i,senderId:Number(this.currentUserId()),receiverId:Number(this.receiverId())})}}onModelChange(i){this.newMessageContent=i,setTimeout(()=>{let e=this.messageInput.nativeElement;e.scrollHeight>e.clientHeight?this.newMessageContent=this.previousMessageContent:(this.previousMessageContent=this.newMessageContent,this.typingHandler())},0)}typingHandler(){this.chatStateService.updateDraftMessage(this.newMessageContent),this.activeChatId()&&(this.typingTimeout&&clearTimeout(this.typingTimeout),this.isTyping()||(this.isTyping.set(!0),this.chatService.sendTypingIndicator(this.activeChatId(),!0)),this.typingTimeout=setTimeout(()=>{this.isTyping.set(!1),this.chatService.sendTypingIndicator(this.activeChatId(),!1)},1e3))}ngOnDestroy(){this.typingTimeout&&clearTimeout(this.typingTimeout),this.isTyping()&&this.chatService.sendTypingIndicator(this.activeChatId(),!1)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-message-input"]],viewQuery:function(e,o){if(e&1&&L(pt,5),e&2){let n;_(n=C())&&(o.messageInput=n.first)}},inputs:{activeChatId:[1,"activeChatId"],receiverId:[1,"receiverId"]},outputs:{messageSent:"messageSent"},decls:4,vars:4,consts:[["messageInput",""],["rows","1","maxlength","362",3,"ngModelChange","keydown","ngModel","placeholder"],["icon","pi pi-send","tabindex","-1","severity","success",3,"onClick","onMouseDown"]],template:function(e,o){if(e&1){let n=x();p(0,"textarea",1,0),D(2,"translate"),b("ngModelChange",function(l){return f(n),h(o.onModelChange(l))})("keydown",function(l){return f(n),h(o.onKeyPress(l))}),m(),p(3,"p-button",2),b("onClick",function(){return f(n),h(o.sendMessage())})("onMouseDown",function(l){return f(n),h(o.onSendButtonMouseDown(l))}),m()}e&2&&a("ngModel",o.newMessageContent)("placeholder",B(2,2,"Type your message..."))},dependencies:[S,w,V,te,W,Ke,We,Xe,Ge],styles:["[_nghost-%COMP%]{display:flex;padding:4px;background:#18181b6b;gap:10px;align-items:center}[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]{flex-grow:1;padding:4px;resize:none;border:1px solid transparent;border-radius:6px;height:64px;font-family:inherit;font-size:.875rem;background:#0004;transition:border-color .2s ease;overflow:hidden}[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 2px #007bff40}[_nghost-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:#999}[_nghost-%COMP%]     .p-button{height:64px;width:64px;background:radial-gradient(circle at center,#0009 0% 50%,#34f5dd33)!important}"]})};var mt=["header"],dt=["footer"],gt=["rejecticon"],ut=["accepticon"],ft=["message"],ht=["icon"],_t=["headless"],Ct=[[["p-footer"]]],bt=["p-footer"],vt=(t,i,e)=>({$implicit:t,onAccept:i,onReject:e}),yt=t=>({$implicit:t});function xt(t,i){t&1&&z(0)}function Tt(t,i){if(t&1&&s(0,xt,1,0,"ng-container",6),t&2){let e=r(2);a("ngTemplateOutlet",e.headlessTemplate||e._headlessTemplate)("ngTemplateOutletContext",Ve(2,vt,e.confirmation,e.onAccept.bind(e),e.onReject.bind(e)))}}function Mt(t,i){t&1&&s(0,Tt,1,6,"ng-template",null,2,U)}function It(t,i){t&1&&z(0)}function St(t,i){if(t&1&&(p(0,"div",7),s(1,It,1,0,"ng-container",8),m()),t&2){let e=r(3);a("ngClass",e.cx("header")),c(),a("ngTemplateOutlet",e.headerTemplate||e._headerTemplate)}}function Ot(t,i){t&1&&s(0,St,2,2,"ng-template",null,4,U)}function wt(t,i){}function Pt(t,i){t&1&&s(0,wt,0,0,"ng-template")}function kt(t,i){if(t&1&&s(0,Pt,1,0,null,8),t&2){let e=r(3);a("ngTemplateOutlet",e.iconTemplate||e._iconTemplate)}}function Et(t,i){if(t&1&&g(0,"i",7),t&2){let e=r(4);H(e.option("icon")),a("ngClass",e.cx("icon"))}}function Dt(t,i){if(t&1&&s(0,Et,1,3,"i",11),t&2){let e=r(3);a("ngIf",e.option("icon"))}}function Bt(t,i){}function jt(t,i){t&1&&s(0,Bt,0,0,"ng-template")}function Vt(t,i){if(t&1&&s(0,jt,1,0,null,6),t&2){let e=r(3);a("ngTemplateOutlet",e.messageTemplate||e._messageTemplate)("ngTemplateOutletContext",je(2,yt,e.confirmation))}}function Rt(t,i){if(t&1&&g(0,"span",10),t&2){let e=r(3);a("ngClass",e.cx("message"))("innerHTML",e.option("message"),Se)}}function Lt(t,i){if(t&1&&s(0,kt,1,1)(1,Dt,1,1,"i",9)(2,Vt,1,4)(3,Rt,1,2,"span",10),t&2){let e=r(2);T(e.iconTemplate||e._iconTemplate?0:!e.iconTemplate&&!e._iconTemplate&&!e._messageTemplate&&!e.messageTemplate?1:-1),c(2),T(e.messageTemplate||e._messageTemplate?2:3)}}function Ut(t,i){if(t&1&&s(0,Ot,2,0)(1,Lt,4,2,"ng-template",null,3,U),t&2){let e=r();T(e.headerTemplate||e._headerTemplate?0:-1)}}function At(t,i){t&1&&z(0)}function Nt(t,i){if(t&1&&(Be(0),s(1,At,1,0,"ng-container",8)),t&2){let e=r(2);c(),a("ngTemplateOutlet",e.footerTemplate||e._footerTemplate)}}function Ft(t,i){if(t&1&&g(0,"i"),t&2){let e=r(5);H(e.option("rejectIcon"))}}function Qt(t,i){if(t&1&&s(0,Ft,1,2,"i",15),t&2){let e=r(4);a("ngIf",e.option("rejectIcon"))}}function Ht(t,i){}function zt(t,i){t&1&&s(0,Ht,0,0,"ng-template")}function $t(t,i){if(t&1){let e=x();p(0,"p-button",13),b("onClick",function(){f(e);let n=r(3);return h(n.onReject())}),s(1,Qt,1,1,"i",14)(2,zt,1,0,null,8),m()}if(t&2){let e=r(3);a("label",e.rejectButtonLabel)("styleClass",e.getButtonStyleClass("pcRejectButton","rejectButtonStyleClass"))("ariaLabel",e.option("rejectButtonProps","ariaLabel"))("buttonProps",e.getRejectButtonProps()),c(),T(e.rejectIcon&&!e.rejectIconTemplate&&!e._rejectIconTemplate?1:-1),c(),a("ngTemplateOutlet",e.rejectIconTemplate||e._rejectIconTemplate)}}function qt(t,i){if(t&1&&g(0,"i"),t&2){let e=r(5);H(e.option("acceptIcon"))}}function Zt(t,i){if(t&1&&s(0,qt,1,2,"i",15),t&2){let e=r(4);a("ngIf",e.option("acceptIcon"))}}function Yt(t,i){}function Jt(t,i){t&1&&s(0,Yt,0,0,"ng-template")}function Kt(t,i){if(t&1){let e=x();p(0,"p-button",13),b("onClick",function(){f(e);let n=r(3);return h(n.onAccept())}),s(1,Zt,1,1,"i",14)(2,Jt,1,0,null,8),m()}if(t&2){let e=r(3);a("label",e.acceptButtonLabel)("styleClass",e.getButtonStyleClass("pcAcceptButton","acceptButtonStyleClass"))("ariaLabel",e.option("acceptButtonProps","ariaLabel"))("buttonProps",e.getAcceptButtonProps()),c(),T(e.acceptIcon&&!e._acceptIconTemplate&&!e.acceptIconTemplate?1:-1),c(),a("ngTemplateOutlet",e.acceptIconTemplate||e._acceptIconTemplate)}}function Wt(t,i){if(t&1&&s(0,$t,3,6,"p-button",12)(1,Kt,3,6,"p-button",12),t&2){let e=r(2);a("ngIf",e.option("rejectVisible")),c(),a("ngIf",e.option("acceptVisible"))}}function Gt(t,i){if(t&1&&s(0,Nt,2,1)(1,Wt,2,2),t&2){let e=r();T(e.footerTemplate||e._footerTemplate?0:-1),c(),T(!e.footerTemplate&&!e._footerTemplate?1:-1)}}var Xt=({dt:t})=>`
.p-confirmdialog .p-dialog-content {
    display: flex;
    align-items: center;
    gap:  ${t("confirmdialog.content.gap")};
}

.p-confirmdialog .p-confirmdialog-icon {
    color: ${t("confirmdialog.icon.color")};
    font-size: ${t("confirmdialog.icon.size")};
    width: ${t("confirmdialog.icon.size")};
    height: ${t("confirmdialog.icon.size")};
}
`,ei={root:"p-confirmdialog",icon:"p-confirmdialog-icon",message:"p-confirmdialog-message",pcRejectButton:"p-confirmdialog-reject-button",pcAcceptButton:"p-confirmdialog-accept-button"},at=(()=>{class t extends qe{name="confirmdialog";theme=Xt;classes=ei;static \u0275fac=(()=>{let e;return function(n){return(e||(e=Te(t)))(n||t)}})();static \u0275prov=ye({token:t,factory:t.\u0275fac})}return t})();var ti=ue([Z({transform:"{{transform}}",opacity:0}),de("{{transition}}",Z({transform:"none",opacity:1}))]),ii=ue([de("{{transition}}",Z({transform:"{{transform}}",opacity:0}))]),be=(()=>{class t extends Ze{confirmationService;zone;header;icon;message;get style(){return this._style}set style(e){this._style=e,this.cd.markForCheck()}styleClass;maskStyleClass;acceptIcon;acceptLabel;closeAriaLabel;acceptAriaLabel;acceptVisible=!0;rejectIcon;rejectLabel;rejectAriaLabel;rejectVisible=!0;acceptButtonStyleClass;rejectButtonStyleClass;closeOnEscape=!0;dismissableMask;blockScroll=!0;rtl=!1;closable=!0;appendTo="body";key;autoZIndex=!0;baseZIndex=0;transitionOptions="150ms cubic-bezier(0, 0, 0.2, 1)";focusTrap=!0;defaultFocus="accept";breakpoints;get visible(){return this._visible}set visible(e){this._visible=e,this._visible&&!this.maskVisible&&(this.maskVisible=!0),this.cd.markForCheck()}get position(){return this._position}set position(e){switch(this._position=e,e){case"topleft":case"bottomleft":case"left":this.transformOptions="translate3d(-100%, 0px, 0px)";break;case"topright":case"bottomright":case"right":this.transformOptions="translate3d(100%, 0px, 0px)";break;case"bottom":this.transformOptions="translate3d(0px, 100%, 0px)";break;case"top":this.transformOptions="translate3d(0px, -100%, 0px)";break;default:this.transformOptions="scale(0.7)";break}}draggable=!0;onHide=new j;footer;_componentStyle=u(at);headerTemplate;footerTemplate;rejectIconTemplate;acceptIconTemplate;messageTemplate;iconTemplate;headlessTemplate;templates;_headerTemplate;_footerTemplate;_rejectIconTemplate;_acceptIconTemplate;_messageTemplate;_iconTemplate;_headlessTemplate;confirmation;_visible;_style;maskVisible;dialog;wrapper;contentContainer;subscription;preWidth;_position="center";transformOptions="scale(0.7)";styleElement;id=he("pn_id_");ariaLabelledBy=this.getAriaLabelledBy();translationSubscription;get containerClass(){return this.cx("root")+" "+this.styleClass||" "}constructor(e,o){super(),this.confirmationService=e,this.zone=o,this.subscription=this.confirmationService.requireConfirmation$.subscribe(n=>{if(!n){this.hide();return}n.key===this.key&&(this.confirmation=n,Object.keys(n).forEach(l=>{this[l]=n[l]}),this.confirmation.accept&&(this.confirmation.acceptEvent=new j,this.confirmation.acceptEvent.subscribe(this.confirmation.accept)),this.confirmation.reject&&(this.confirmation.rejectEvent=new j,this.confirmation.rejectEvent.subscribe(this.confirmation.reject)),this.visible=!0)})}ngOnInit(){super.ngOnInit(),this.breakpoints&&this.createStyle(),this.translationSubscription=this.config.translationObserver.subscribe(()=>{this.visible&&this.cd.markForCheck()})}ngAfterContentInit(){this.templates?.forEach(e=>{switch(e.getType()){case"header":this._headerTemplate=e.template;break;case"footer":this._footerTemplate=e.template;break;case"message":this._messageTemplate=e.template;break;case"icon":this._iconTemplate=e.template;break;case"rejecticon":this._rejectIconTemplate=e.template;break;case"accepticon":this._acceptIconTemplate=e.template;break;case"headless":this._headlessTemplate=e.template;break}})}getAriaLabelledBy(){return this.header!==null?he("pn_id_")+"_header":null}option(e,o){let n=this;if(n.hasOwnProperty(e))return o?n[o]:n[e]}getButtonStyleClass(e,o){let n=this.cx(e),d=this.option(o);return[n,d].filter(Boolean).join(" ")}getElementToFocus(){switch(this.option("defaultFocus")){case"accept":return A(this.dialog.el.nativeElement,".p-confirm-dialog-accept");case"reject":return A(this.dialog.el.nativeElement,".p-confirm-dialog-reject");case"close":return A(this.dialog.el.nativeElement,".p-dialog-header-close");case"none":return null;default:return A(this.dialog.el.nativeElement,".p-confirm-dialog-accept")}}createStyle(){if(!this.styleElement){this.styleElement=this.document.createElement("style"),this.styleElement.type="text/css",this.document.head.appendChild(this.styleElement);let e="";for(let o in this.breakpoints)e+=`
                    @media screen and (max-width: ${o}) {
                        .p-dialog[${this.id}] {
                            width: ${this.breakpoints[o]} !important;
                        }
                    }
                `;this.styleElement.innerHTML=e,He(this.styleElement,"nonce",this.config?.csp()?.nonce)}}close(){this.confirmation?.rejectEvent&&this.confirmation.rejectEvent.emit(R.CANCEL),this.hide(R.CANCEL)}hide(e){this.onHide.emit(e),this.visible=!1,this.unsubscribeConfirmationEvents(),this.confirmation=null}destroyStyle(){this.styleElement&&(this.document.head.removeChild(this.styleElement),this.styleElement=null)}ngOnDestroy(){this.subscription.unsubscribe(),this.unsubscribeConfirmationEvents(),this.translationSubscription&&this.translationSubscription.unsubscribe(),this.destroyStyle(),super.ngOnDestroy()}onVisibleChange(e){e?this.visible=e:this.close()}onAccept(){this.confirmation&&this.confirmation.acceptEvent&&this.confirmation.acceptEvent.emit(),this.hide(R.ACCEPT)}onReject(){this.confirmation&&this.confirmation.rejectEvent&&this.confirmation.rejectEvent.emit(R.REJECT),this.hide(R.REJECT)}unsubscribeConfirmationEvents(){this.confirmation&&(this.confirmation.acceptEvent?.unsubscribe(),this.confirmation.rejectEvent?.unsubscribe())}get acceptButtonLabel(){return this.option("acceptLabel")||this.config.getTranslation(_e.ACCEPT)}get rejectButtonLabel(){return this.option("rejectLabel")||this.config.getTranslation(_e.REJECT)}getAcceptButtonProps(){return this.option("acceptButtonProps")}getRejectButtonProps(){return this.option("rejectButtonProps")}static \u0275fac=function(o){return new(o||t)(pe(N),pe(Me))};static \u0275cmp=y({type:t,selectors:[["p-confirmDialog"],["p-confirmdialog"],["p-confirm-dialog"]],contentQueries:function(o,n,d){if(o&1&&(I(d,ze,5),I(d,mt,4),I(d,dt,4),I(d,gt,4),I(d,ut,4),I(d,ft,4),I(d,ht,4),I(d,_t,4),I(d,$e,4)),o&2){let l;_(l=C())&&(n.footer=l.first),_(l=C())&&(n.headerTemplate=l.first),_(l=C())&&(n.footerTemplate=l.first),_(l=C())&&(n.rejectIconTemplate=l.first),_(l=C())&&(n.acceptIconTemplate=l.first),_(l=C())&&(n.messageTemplate=l.first),_(l=C())&&(n.iconTemplate=l.first),_(l=C())&&(n.headlessTemplate=l.first),_(l=C())&&(n.templates=l)}},inputs:{header:"header",icon:"icon",message:"message",style:"style",styleClass:"styleClass",maskStyleClass:"maskStyleClass",acceptIcon:"acceptIcon",acceptLabel:"acceptLabel",closeAriaLabel:"closeAriaLabel",acceptAriaLabel:"acceptAriaLabel",acceptVisible:[2,"acceptVisible","acceptVisible",M],rejectIcon:"rejectIcon",rejectLabel:"rejectLabel",rejectAriaLabel:"rejectAriaLabel",rejectVisible:[2,"rejectVisible","rejectVisible",M],acceptButtonStyleClass:"acceptButtonStyleClass",rejectButtonStyleClass:"rejectButtonStyleClass",closeOnEscape:[2,"closeOnEscape","closeOnEscape",M],dismissableMask:[2,"dismissableMask","dismissableMask",M],blockScroll:[2,"blockScroll","blockScroll",M],rtl:[2,"rtl","rtl",M],closable:[2,"closable","closable",M],appendTo:"appendTo",key:"key",autoZIndex:[2,"autoZIndex","autoZIndex",M],baseZIndex:[2,"baseZIndex","baseZIndex",Re],transitionOptions:"transitionOptions",focusTrap:[2,"focusTrap","focusTrap",M],defaultFocus:"defaultFocus",breakpoints:"breakpoints",visible:"visible",position:"position",draggable:[2,"draggable","draggable",M]},outputs:{onHide:"onHide"},features:[q([at]),we],ngContentSelectors:bt,decls:6,vars:14,consts:[["dialog",""],["footer",""],["headless",""],["content",""],["header",""],["role","alertdialog",3,"visibleChange","visible","closable","styleClass","modal","header","closeOnEscape","blockScroll","appendTo","position","dismissableMask","draggable"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ngClass"],[4,"ngTemplateOutlet"],[3,"ngClass","class"],[3,"ngClass","innerHTML"],[3,"ngClass","class",4,"ngIf"],[3,"label","styleClass","ariaLabel","buttonProps","onClick",4,"ngIf"],[3,"onClick","label","styleClass","ariaLabel","buttonProps"],[3,"class"],[3,"class",4,"ngIf"]],template:function(o,n){if(o&1){let d=x();De(Ct),p(0,"p-dialog",5,0),b("visibleChange",function(lt){return f(d),h(n.onVisibleChange(lt))}),s(2,Mt,2,0)(3,Ut,3,1)(4,Gt,2,2,"ng-template",null,1,U),m()}o&2&&(Ee(n.style),a("visible",n.visible)("closable",n.option("closable"))("styleClass",n.containerClass)("modal",!0)("header",n.option("header"))("closeOnEscape",n.option("closeOnEscape"))("blockScroll",n.option("blockScroll"))("appendTo",n.option("appendTo"))("position",n.position)("dismissableMask",n.dismissableMask)("draggable",n.draggable),c(2),T(n.headlessTemplate||n._headlessTemplate?2:3))},dependencies:[S,Ue,O,Ne,te,et,Y],encapsulation:2,data:{animation:[Fe("animation",[ge("void => visible",[fe(ti)]),ge("visible => void",[fe(ii)])])]},changeDetection:0})}return t})(),st=(()=>{class t{static \u0275fac=function(o){return new(o||t)};static \u0275mod=Oe({type:t});static \u0275inj=xe({imports:[be,Y,Y]})}return t})();function si(t,i){if(t&1){let e=x();p(0,"button",1),D(1,"translate"),D(2,"translate"),b("click",function(n){f(e);let d=r();return h(d.onDelete(n))}),g(3,"i",2),m()}t&2&&(a("title",B(1,2,"chat.deleteMessage")),Pe("aria-label",B(2,4,"chat.deleteMessage")))}var ce=class t{message;currentUserId;deleteMessage=new j;onDelete(i){this.deleteMessage.emit({event:i,message:this.message})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-message-delete-button"]],inputs:{message:"message",currentUserId:"currentUserId"},outputs:{deleteMessage:"deleteMessage"},decls:1,vars:1,consts:[["type","button","class","delete-icon-btn","pButton","","pRipple","",3,"title","click",4,"ngIf"],["type","button","pButton","","pRipple","",1,"delete-icon-btn",3,"click","title"],["aria-hidden","true",1,"pi","pi-trash"]],template:function(e,o){e&1&&s(0,si,4,6,"button",0),e&2&&a("ngIf",o.message.sender.id===o.currentUserId)},dependencies:[S,O,ie,ee,X,G,w,V],styles:["[_nghost-%COMP%]{display:contents}.delete-icon-btn[_ngcontent-%COMP%]{width:24px;height:24px;min-width:24px;padding:0;display:flex;align-items:center;justify-content:center;background:transparent!important;border:none!important;box-shadow:none!important;transition:all .2s ease;opacity:0;cursor:pointer;border-radius:50%}.delete-icon-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px;color:#fff9;transition:all .2s ease}.delete-icon-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.delete-icon-btn[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{color:#34f5f5}.delete-icon-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}.delete-icon-btn[_ngcontent-%COMP%]:focus{outline:2px solid rgba(255,59,48,.4);outline-offset:2px}.message   div:hover[_nghost-%COMP%]   .delete-icon-btn[_ngcontent-%COMP%], .message   div:hover   [_nghost-%COMP%]   .delete-icon-btn[_ngcontent-%COMP%]{opacity:1}"]})};var ri=["messagesContainer"],li=["messageInput"];function ci(t,i){t&1&&(p(0,"div",3),g(1,"app-loader"),m())}function pi(t,i){if(t&1){let e=x();p(0,"div",9)(1,"div")(2,"div",10),E(3),m(),p(4,"div",11)(5,"small"),E(6),m(),p(7,"app-message-delete-button",12),b("deleteMessage",function(n){f(e);let d=r(2);return h(d.onDeleteMessage(n.event,n.message))}),m()()()()}if(t&2){let e=i.$implicit,o=r(2);c(),ke("sender",e.sender.id===o.currentUserId())("receiver",e.sender.id!==o.currentUserId()),c(2),me(" ",e.content," "),c(3),me(" ",o.formatMessageTime(e.timestamp)," "),c(),a("message",e)("currentUserId",o.currentUserId())}}function mi(t,i){if(t&1){let e=x();p(0,"button",13),b("click",function(){f(e);let n=r(2);return h(n.scrollToBottomManual())}),g(1,"i",14),m()}}function di(t,i){if(t&1){let e=x();g(0,"app-chat-header",4),p(1,"div",5,0),b("scroll",function(){f(e);let n=r();return h(n.onScroll())}),s(3,pi,8,8,"div",6),m(),g(4,"p-confirmDialog"),p(5,"app-message-input",7),b("messageSent",function(n){f(e);let d=r();return h(d.handleMessageSent(n))}),m(),s(6,mi,2,0,"button",8)}if(t&2){let e=r();a("interlocutorProfile",e.interlocutorProfile())("isOnline",e.isOnline())("isTyping",e.getTypingIndicatorVisible()),c(3),a("ngForOf",e.messages)("ngForTrackBy",e.trackByMessageId),c(2),a("activeChatId",e.activeChatId())("receiverId",e.receiverId),c(),a("ngIf",e.showScrollToBottom())}}var rt=class t{chatService=u(oe);route=u(Ye);stateService=u(J);chatStateService=u(K);destroy$=new ve;authTokenStateService=u(Je);token=v(()=>this.authTokenStateService.token());interlocutorService=u(ne);confirmationService=u(N);translateService=u(Qe);myProfile=v(()=>this.stateService.profile()||null);currentUserId=v(()=>this.myProfile()?.userId||"");interlocutor=v(()=>this.interlocutorService.interlocutor()||null);isOnline=v(()=>this.interlocutor()?.isOnline||!1);interlocutorProfile=v(()=>this.interlocutor()?.profile||null);receiverId="";messagesContainer;messageInput;messages=[];isLoading=k(!1);showScrollToBottom=k(!1);activeChatId=k("");typingUsers=k([]);messageSubscription;previousMessagesSubscription;shouldScrollToBottom=!1;scrollTimeout=null;isUserScrolling=!1;constructor(){Le(()=>{let i=this.token();i&&this.chatService.connect(i)})}ngOnInit(){this.route.paramMap.subscribe(i=>{this.receiverId=i.get("receiverId")||"",this.receiverId&&(this.isLoading.set(!0),this.chatService.isConnected()?this.startChatRoom():this.chatService.onConnect().pipe(Q(this.destroy$)).subscribe(()=>{this.startChatRoom()}))})}startChatRoom(){this.joinChatRoom(),this.subscribeToMessages(),this.setupEnhancedSocketListeners()}setupEnhancedSocketListeners(){this.chatService.onUserTyping().pipe(Q(this.destroy$)).subscribe(i=>{i.chatId===this.activeChatId()&&this.updateTypingUsers(i)}),this.chatService.onMessageRemoved().pipe(Q(this.destroy$)).subscribe(i=>{i.chatId===this.activeChatId()&&this.removeMessageFromUI(i.messageId)})}updateTypingUsers(i){let e=this.typingUsers();i.isTyping?e.find(o=>o.userId===i.userId)||this.typingUsers.set([...e,i]):this.typingUsers.set(e.filter(o=>o.userId!==i.userId))}getTypingIndicatorVisible(){return this.typingUsers().length>0&&!this.typingUsers().some(i=>i.userId===this.currentUserId())}ngAfterViewChecked(){this.shouldScrollToBottom&&!this.isUserScrolling&&(this.scrollToBottomSmooth(),this.shouldScrollToBottom=!1)}scrollToBottomSmooth(){try{if(this.messagesContainer?.nativeElement){let i=this.messagesContainer.nativeElement;i.scrollTo({top:i.scrollHeight,behavior:"smooth"})}}catch(i){console.warn("Could not scroll to bottom:",i)}}scrollToBottom(){try{if(this.messagesContainer?.nativeElement){let i=this.messagesContainer.nativeElement;i.scrollTop=i.scrollHeight}}catch(i){console.warn("Could not scroll to bottom:",i)}}isNearBottom(){if(!this.messagesContainer?.nativeElement)return!1;let i=this.messagesContainer.nativeElement;return i.scrollTop+i.clientHeight>=i.scrollHeight-100}onScroll(){this.isUserScrolling=!0,this.scrollTimeout&&clearTimeout(this.scrollTimeout);let i=this.isNearBottom();this.showScrollToBottom.set(!i),this.scrollTimeout=setTimeout(()=>{this.isUserScrolling=!1,i&&(this.shouldScrollToBottom=!0)},150)}subscribeToMessages(){this.messageSubscription=this.chatService.onReceiveMessage().subscribe(i=>{let e=this.isNearBottom();console.log("Received message:",i),i.sender.id!==this.currentUserId()&&(this.messages=[...this.messages,i],this.updateChatUnreadCount()),(e||i.sender.id===this.currentUserId())&&(this.shouldScrollToBottom=!0)})}handleMessageSent(i){this.messages.push(i),this.shouldScrollToBottom=!0}ngOnDestroy(){this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.messageSubscription&&this.messageSubscription.unsubscribe(),this.previousMessagesSubscription&&this.previousMessagesSubscription.unsubscribe(),this.destroy$.next(),this.destroy$.complete(),this.activeChatId()&&this.chatService.leaveChat(this.activeChatId())}joinChatRoom(){this.chatService.joinChat(Number(this.currentUserId()),Number(this.receiverId)).subscribe(i=>{console.log(`Joined chat with ID: ${i}`),this.activeChatId.set(i)}),this.previousMessagesSubscription=this.chatService.onPreviousMessages().subscribe(({messages:i,chat:e})=>{let o=e.participant1?.id===this.currentUserId()?e.participant2:e.participant1;o&&this.interlocutorService.interlocutor.set(o),console.log("Joined chat room:",e),this.messages=i,this.isLoading.set(!1),this.activeChatId.set(e.id),setTimeout(()=>{this.scrollToBottom(),this.showScrollToBottom.set(!1)},100)})}updateChatUnreadCount(){this.activeChatId()&&this.chatStateService.markChatAsRead(this.activeChatId())}formatMessageTime(i){if(!i)return"";let e=typeof i=="string"?new Date(i):i;return Math.abs(new Date().getTime()-e.getTime())/(1e3*60*60)<24?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString([],{month:"short",day:"numeric"})}trackByMessageId(i,e){return e.id||i}scrollToBottomManual(){this.isUserScrolling=!1,this.shouldScrollToBottom=!0,this.scrollToBottomSmooth()}removeMessageFromUI(i){this.messages=this.messages.filter(e=>String(e.id)!==String(i))}onDeleteMessage(i,e){console.log("Delete message requested:",e.sender.id!==this.currentUserId()),i.stopPropagation(),e.sender.id===this.currentUserId()&&this.confirmationService.confirm({target:i.target,message:this.translateService.instant("chat.deleteConfirmation.message"),header:this.translateService.instant("chat.deleteConfirmation.header"),icon:"pi pi-exclamation-triangle",acceptIcon:"pi pi-trash",rejectIcon:"pi pi-times",acceptLabel:this.translateService.instant("chat.deleteConfirmation.accept"),rejectLabel:this.translateService.instant("chat.deleteConfirmation.reject"),acceptButtonStyleClass:"p-button-danger p-button-sm",rejectButtonStyleClass:"p-button-text p-button-sm",accept:()=>{this.deleteMessage(e)}})}deleteMessage(i){this.chatService.removeMessage(Number(i.id)),this.removeMessageFromUI(Number(i.id))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-chat"]],viewQuery:function(e,o){if(e&1&&(L(ri,5),L(li,5)),e&2){let n;_(n=C())&&(o.messagesContainer=n.first),_(n=C())&&(o.messageInput=n.first)}},inputs:{receiverId:"receiverId"},features:[q([N])],decls:3,vars:2,consts:[["messagesContainer",""],[1,"chat-container"],["class","loader-container",4,"ngIf"],[1,"loader-container"],[3,"interlocutorProfile","isOnline","isTyping"],[1,"messages",3,"scroll"],["class","message",4,"ngFor","ngForOf","ngForTrackBy"],[3,"messageSent","activeChatId","receiverId"],["type","button","pButton","","pRipple","","class","p-button p-button-secondary scroll-to-bottom-btn","title","Scroll to bottom","aria-label","Scroll to newest messages",3,"click",4,"ngIf"],[1,"message"],[1,"message-content"],[1,"message-meta"],[3,"deleteMessage","message","currentUserId"],["type","button","pButton","","pRipple","","title","Scroll to bottom","aria-label","Scroll to newest messages",1,"p-button","p-button-secondary","scroll-to-bottom-btn",3,"click"],["aria-hidden","true",1,"pi","pi-chevron-down"]],template:function(e,o){e&1&&(p(0,"div",1),s(1,ci,2,0,"div",2)(2,di,7,8),m()),e&2&&(c(),a("ngIf",!o.interlocutorProfile()||o.isLoading()),c(),T(o.interlocutorProfile()&&!o.isLoading()?2:-1))},dependencies:[S,Ae,O,W,tt,re,w,le,st,be,ie,ee,X,G,ce],styles:['.receiver[_ngcontent-%COMP%]{background:radial-gradient(circle at 20% 30%,rgba(52,245,245,.5) 0%,transparent 122%),radial-gradient(circle at 80% 20%,rgba(52,211,245,.4) 0%,transparent 60%),radial-gradient(circle at 60% 80%,rgba(45,212,245,.4) 0%,transparent 55%),radial-gradient(circle at 30% 60%,rgba(16,185,245,.3) 0%,transparent 45%),linear-gradient(135deg,#18181b4d,#1a1a1d33,#1212144d,#1a1a1d33,#18181b4d);border:1px solid rgba(52,245,221,.1);box-shadow:0 8px 8px #0000004d}.sender[_ngcontent-%COMP%]{background:radial-gradient(circle at 20% 30%,rgba(52,245,221,.5) 0%,transparent 122%),radial-gradient(circle at 80% 20%,rgba(52,211,204,.4) 0%,transparent 60%),radial-gradient(circle at 60% 80%,rgba(45,212,191,.4) 0%,transparent 55%),radial-gradient(circle at 30% 60%,rgba(16,185,129,.3) 0%,transparent 45%),linear-gradient(135deg,#18181b4d,#1a1a1d33,#1212144d,#1a1a1d33,#18181b4d);border:1px solid rgba(52,245,221,.1);box-shadow:0 8px 8px #0000004d}.messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff1a;border-radius:3px}.messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#ffffff4d;border-radius:3px}.messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#ffffff80}[_nghost-%COMP%]{display:flex;justify-content:flex-end;width:100%;padding:55px 10px 10px;height:100%}.chat-container[_ngcontent-%COMP%]{width:100%;max-width:400px;border:1px solid rgba(52,245,221,.1);border-radius:8px;display:flex;flex-direction:column;height:100%;overflow:hidden}.chat-container[_ngcontent-%COMP%]   .loader-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%}.messages[_ngcontent-%COMP%]{flex:1;padding:15px;overflow-y:auto;overflow-x:hidden;background:#18181b6b;scroll-behavior:auto;position:relative}.scroll-to-bottom-btn[_ngcontent-%COMP%]{position:absolute;bottom:104px;right:18px;width:44px;height:44px;padding:0;border-radius:333px;display:flex;align-items:center;justify-content:center;z-index:10;animation:_ngcontent-%COMP%_fadeInUp .25s ease-out;background:#000c!important;border:1px solid #ffffff!important;color:#fff!important}.scroll-to-bottom-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}.scroll-to-bottom-btn[_ngcontent-%COMP%]:hover{border-color:#fff!important;color:#fff!important;transform:translateY(-2px);box-shadow:0 6px 16px #ffffff40}.scroll-to-bottom-btn[_ngcontent-%COMP%]:active{transform:translateY(0) scale(.97);box-shadow:none}.message[_ngcontent-%COMP%]{margin-bottom:12px;display:flex;color:#000;font-size:16px;font-weight:400}.message[_ngcontent-%COMP%]:last-child{margin-bottom:0}.message[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:6px 8px 0 6px;border-radius:18px;word-wrap:break-word;position:relative}.sender[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;align-self:flex-end;margin-left:auto;border-bottom-right-radius:6px}.sender[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-3px;right:-4px;width:0;height:0;border:8px solid transparent;border-bottom-color:#44f8c6;border-right:none;border-bottom-right-radius:6px}.sender[_ngcontent-%COMP%]   .message-meta[_ngcontent-%COMP%]{text-align:right}.receiver[_ngcontent-%COMP%]{align-self:flex-start;margin-right:auto;border-bottom-left-radius:6px}.receiver[_ngcontent-%COMP%]:before{content:"";position:absolute;bottom:-3px;left:-4px;width:0;height:0;border:8px solid transparent;border-bottom-color:#44c6d7;border-left:none;border-bottom-left-radius:6px}.receiver[_ngcontent-%COMP%]   .message-meta[_ngcontent-%COMP%]{text-align:left}.message-content[_ngcontent-%COMP%]{max-width:240px;margin-bottom:4px;word-wrap:break-word}.message-meta[_ngcontent-%COMP%]{width:auto;margin-bottom:4px;border:none!important;box-shadow:none!important;padding:0 8px 10px!important;display:flex;align-items:center;justify-content:space-between;gap:8px}.message-meta[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px!important;color:#ffffffb3;opacity:.8}.message[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:hover   .message-meta[_ngcontent-%COMP%]   app-message-delete-button[_ngcontent-%COMP%]     .delete-icon-btn{opacity:1}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 768px){[_nghost-%COMP%]{padding:50px 5px 5px;justify-content:center}.chat-container[_ngcontent-%COMP%]{max-width:99vw}}']})};export{rt as ChatComponent};
