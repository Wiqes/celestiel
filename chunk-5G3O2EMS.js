import{a as N,b as B}from"./chunk-LES6WOKS.js";import{a as U,d as A}from"./chunk-ORL6YT5D.js";import{a as j}from"./chunk-VZIYANPV.js";import{b as L}from"./chunk-65LKHUET.js";import{f as D}from"./chunk-K5BU6CYA.js";import"./chunk-6C2J5BQ3.js";import"./chunk-APZXJAS2.js";import{d as z,e as $,f as F}from"./chunk-MAXMR2XW.js";import{c as E}from"./chunk-OHSBJFGJ.js";import{l as k,m as T}from"./chunk-ZXNNLAB3.js";import{Ab as u,Eb as S,Ib as I,Jb as g,N as x,Ra as o,Tb as r,Ub as _,Vb as f,X as p,cb as b,da as O,ea as P,hb as l,k as M,ob as d,qb as w,tc as c,ub as y,yb as i,zb as a}from"./chunk-QP7WRVZV.js";function V(n,e){n&1&&(i(0,"div",1),u(1,"app-loader"),a())}function q(n,e){if(n&1&&(i(0,"div",19),r(1),a()),n&2){let t=g().$implicit;o(),_(t.profile.name)}}function G(n,e){if(n&1&&(i(0,"div",20),r(1),a()),n&2){let t=g().$implicit;o(),f(" ",t.unreadCount," ")}}function H(n,e){if(n&1){let t=S();i(0,"div",8),I("click",function(){let h=O(t).$implicit,m=g(2);return P(m.openChat(h.userId))}),i(1,"div",9),u(2,"app-chat-avatar",10)(3,"app-online-status",11),a(),i(4,"div",12)(5,"div",13),l(6,q,2,1,"div",14),i(7,"div",15),r(8),a()(),i(9,"div",16)(10,"span",17),r(11),a(),l(12,G,2,1,"div",18),a()()()}if(n&2){let t=e.$implicit,s=g(2);w("has-unread",t.unreadCount&&t.unreadCount>0),o(2),d("profile",t.profile),o(),d("isOnline",t.isOnline),o(3),d("ngIf",t.profile==null?null:t.profile.name),o(2),f(" ",s.formatLastMessageTime(t.lastMessageAt)," "),o(3),_(t.lastMessage),o(),d("ngIf",t.unreadCount&&t.unreadCount>0)}}function J(n,e){n&1&&(i(0,"div",21)(1,"div",22),r(2,"\u{1F4AC}"),a(),i(3,"h3"),r(4,"No conversations yet"),a(),i(5,"p"),r(6,"Start a new conversation to see it here"),a()())}function K(n,e){if(n&1&&(i(0,"div",2)(1,"h2",3),r(2,"Messages"),a(),i(3,"div",4),r(4),a()(),i(5,"div",5),l(6,H,13,8,"div",6),a(),l(7,J,7,0,"div",7)),n&2){let t=g();o(4),f("",t.interlocutors().length," conversations"),o(2),d("ngForOf",t.interlocutors())("ngForTrackBy",t.trackByFn),o(),d("ngIf",t.interlocutors().length===0)}}var R=class n{chatStateService=p(U);chats=c(()=>this.chatStateService.chats());chatService=p(A);stateService=p(E);router=p(D);currentUserProfile=c(()=>this.stateService.profile());currentUserId=c(()=>this.currentUserProfile()?.userId||"");destroy$=new M;user=c(()=>this.stateService.user());isSocketAuthenticated=c(()=>this.chatService.isUserAuthenticated());isChatsLoading=c(()=>this.chatService.isChatsLoading()||!this.isSocketAuthenticated());interlocutors=c(()=>this.chats()?this.chats()?.map(e=>{console.log("chat",this.currentUserId());let t=e.participant1Id===Number(this.currentUserId())?e.participant2:e.participant1;return{id:t?.id||"",chatId:e.id,userId:t?.id||"",isOnline:t?.isOnline||!1,profile:t?.profile||null,lastMessageAt:e.lastMessageAt,lastMessage:e.messages[0]?.content||"",unreadCount:this.getUnreadCount(e)}}).sort((e,t)=>{let s=e.lastMessageAt?new Date(e.lastMessageAt).getTime():0;return(t.lastMessageAt?new Date(t.lastMessageAt).getTime():0)-s}):[]);constructor(){this.chatService.onConnect().pipe(x(this.destroy$)).subscribe(()=>{this.connectToUserChats()})}ngOnInit(){this.chatService.isChatsLoading.set(!0),this.chatService.isConnected()&&this.connectToUserChats()}connectToUserChats(){if(console.log("Connecting to user chats",this.chats()),this.chats()){this.chatService.isChatsLoading.set(!1);return}this.chatService.getUserChats()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}trackByFn(e,t){return t.chatId}openChat(e){this.router.navigate(["chat",e])}getUnreadCount(e){return this.chatStateService.getUnreadCount(e)}formatLastMessageTime(e){if(!e)return"";let t=new Date,s=new Date(e),h=t.getTime()-s.getTime(),m=Math.floor(h/(1e3*60)),C=Math.floor(m/60),v=Math.floor(C/24);return m<1?"Now":m<60?`${m}m`:C<24?`${C}h`:v<7?`${v}d`:s.toLocaleDateString()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=b({type:n,selectors:[["app-messages"]],decls:3,vars:1,consts:[[1,"messages-container"],[1,"loader-container"],[1,"messages-header"],[1,"messages-title"],[1,"messages-count"],[1,"chat-list"],["class","chat-item","pRipple","",3,"has-unread","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],["pRipple","",1,"chat-item",3,"click"],[1,"avatar-container"],[3,"profile"],[1,"status-indicator",3,"isOnline"],[1,"chat-content"],[1,"chat-header"],["class","chat-name",4,"ngIf"],[1,"chat-time"],[1,"chat-preview"],[1,"last-message"],["class","unread-badge",4,"ngIf"],[1,"chat-name"],[1,"unread-badge"],[1,"empty-state"],[1,"empty-icon"]],template:function(t,s){t&1&&(i(0,"div",0),l(1,V,2,0,"div",1)(2,K,8,4),a()),t&2&&(o(),y(s.isChatsLoading()?1:2))},dependencies:[k,T,L,F,$,z,N,B,j],styles:['.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff1a;border-radius:3px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#ffffff4d;border-radius:3px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#ffffff80}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%], .chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-weight:600}[_nghost-%COMP%]{display:flex;width:100%;justify-content:flex-end}@media (max-width: 800px){[_nghost-%COMP%]{justify-content:center}[_nghost-%COMP%]   .messages-container[_ngcontent-%COMP%]{right:0;max-width:100%}}.messages-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background:#18181bcc;color:#fff;overflow:hidden;position:relative;top:92px;right:2rem;width:320px;border:1px solid rgba(52,245,221,.2);border-radius:1.5rem}.messages-container[_ngcontent-%COMP%]   .loader-container[_ngcontent-%COMP%]{padding:20px}.messages-header[_ngcontent-%COMP%]{padding:1.5rem 1rem 1rem;border-bottom:1px solid rgba(52,245,221,.1);background:linear-gradient(135deg,rgba(52,245,221,.05) 0%,transparent 100%)}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%]{font-size:1.5rem;margin:0 0 .5rem;font-weight:700}.messages-header[_ngcontent-%COMP%]   .messages-count[_ngcontent-%COMP%]{color:#fff9;font-size:.875rem;font-weight:400}.messages-header[_ngcontent-%COMP%]   .messages-count[_ngcontent-%COMP%]   .unread-indicator[_ngcontent-%COMP%]{color:#34f5dd;font-weight:600}.chat-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;max-height:50vh;max-height:50dvh;padding:.5rem 0 1.5rem}.chat-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem;cursor:pointer;transition:all .2s ease-in-out;border-bottom:1px solid rgba(52,245,221,.05);position:relative}.chat-item[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;bottom:0;width:0;background:#34f5dd;transition:width .2s ease-in-out}.chat-item[_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#34f5dd14,#34f5dd08)}.chat-item[_ngcontent-%COMP%]:hover:before{width:3px}.chat-item.has-unread[_ngcontent-%COMP%]{background:linear-gradient(90deg,#34f5dd1f,#34f5dd0d)}.chat-item.has-unread[_ngcontent-%COMP%]:before{width:3px}.chat-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.avatar-container[_ngcontent-%COMP%]{position:relative;flex-shrink:0}.avatar-container[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{position:absolute;bottom:2px;right:2px;z-index:1}.chat-content[_ngcontent-%COMP%]{flex:1;min-width:0;margin-left:14px}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-time[_ngcontent-%COMP%]{color:#ffffff80;font-size:.75rem;font-weight:400;flex-shrink:0}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .last-message[_ngcontent-%COMP%]{color:#ffffffb3;font-size:.875rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;margin-right:.5rem}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .unread-badge[_ngcontent-%COMP%]{background:#34f5dd;color:#000;font-size:.75rem;font-weight:600;padding:2px 6px;border-radius:10px;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;opacity:.7}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;margin:0 0 .5rem;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff9;margin:0;font-size:.875rem}@media (max-width: 768px){.messages-header[_ngcontent-%COMP%]{padding:1rem .75rem .75rem}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%]{font-size:1.25rem}.chat-item[_ngcontent-%COMP%]{padding:.75rem}.chat-item[_ngcontent-%COMP%]:hover{padding-left:calc(.75rem - 3px)}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-size:.9rem;max-width:65%}}']})};export{R as MessagesComponent};
