import{b as Q}from"./chunk-BTHHUOBS.js";import"./chunk-MHRHA6QM.js";import"./chunk-VZJZGYZ2.js";import"./chunk-SAET7JLB.js";import"./chunk-KBDP62ST.js";import{c as v,f as G,g as H,h as b,j as z,l as $,p as B}from"./chunk-SUNPCG22.js";import"./chunk-E4NDRWNK.js";import"./chunk-GGQ7LRWG.js";import"./chunk-AD62QEJX.js";import"./chunk-F2X3VGZZ.js";import{d as J,e as K}from"./chunk-3YSFKZV4.js";import"./chunk-7REMTZQZ.js";import"./chunk-GWWUM7B3.js";import"./chunk-J53J3ZDA.js";import{b as N,c as q}from"./chunk-2E4SJT4M.js";import{B as O,C as j,Ka as M,m as L}from"./chunk-CTOY3QUY.js";import{Ab as a,Bb as l,Cb as f,G as A,Gb as R,Kb as C,Lb as h,O as F,Qa as P,T as w,Ta as i,Ub as V,Vb as s,Wb as I,Xb as U,Z as m,eb as E,fa as u,ga as g,jb as k,qb as r,ua as T,vc as D}from"./chunk-N7X4JSP7.js";var y=class o{http=m(j);getPresignedUrl(n){return this.http.post(`${M.API_URL}/uploads/signed-url`,n)}uploadFileToS3(n,e){return this.http.put(n,e,{reportProgress:!0,observe:"events"})}deleteFile(n){let e=encodeURIComponent(n);return this.http.delete(`${M.API_URL}/uploads/${e}`)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var S=(e=>(e.MALE="male",e.FEMALE="female",e))(S||{});function Y(o,n){if(o&1&&(a(0,"div"),f(1,"progress",11),s(2),l()),o&2){let e=h();i(),r("value",e.uploadProgress),i(),U(" ",e.uploadProgress,"% ")}}function Z(o,n){if(o&1&&(a(0,"div")(1,"h3"),s(2,"Upload Complete!"),l(),f(3,"img",12),a(4,"p"),s(5," Image URL: "),a(6,"a",13),s(7),l()()()),o&2){let e=h();i(3),r("src",e.uploadedImageUrl,P),i(3),r("href",e.uploadedImageUrl,P),i(),I(e.uploadedImageUrl)}}function ee(o,n){if(o&1&&(a(0,"div")(1,"p",14),s(2),l()()),o&2){let e=h();i(2),U("Error: ",e.error,"")}}var W=class o{selectedFile=null;isUploading=!1;uploadProgress=0;uploadedImageUrl=null;publicUrl=null;error=null;stateService=m(q);uploadService=m(y);dataAccessService=m(N);animals=D(()=>this.stateService.animals());colors=T([]);adminForm=new H({selectedAnimal:new b(null,[v.required]),selectedColor:new b(null,[v.required]),entityType:new b(null,[v.required])});get selectedAnimalControl(){return this.adminForm.get("selectedAnimal")}get selectedColorControl(){return this.adminForm.get("selectedColor")}get entityTypeControl(){return this.adminForm.get("entityType")}entityTypeOptions=Object.values(S).map(n=>({name:n.charAt(0).toUpperCase()+n.slice(1),value:n}));ngOnInit(){if(this.dataAccessService.getColors().subscribe(e=>{this.colors.set(e)}),this.stateService.isDataLoading.set(!0),!(this.stateService.animals().length===0)){this.stateService.isDataLoading.set(!1);return}this.dataAccessService.getAnimals().subscribe({next:e=>{this.stateService.addAnimalsDataToState(e)},error:()=>this.stateService.isDataLoading.set(!1),complete:()=>this.stateService.isDataLoading.set(!1)})}onFileSelected(n){let e=n.target;e.files&&e.files[0]&&(this.selectedFile=e.files[0],this.uploadedImageUrl=null,this.uploadProgress=0,this.error=null)}onUpload(){if(!this.selectedFile||this.adminForm.invalid){this.adminForm.markAllAsTouched();return}let n=this.selectedAnimalControl.value,e=this.selectedColorControl.value,t=this.entityTypeControl.value,p=this.animals().find(d=>d.id===n),c=(p?p[t]:[]).find(d=>d.colorId===e)||null;this.isUploading=!0,this.error=null;let x=this.selectedFile;this.uploadService.getPresignedUrl({filename:x.name,contentType:x.type,entityType:t,entityId:c?.id||0}).pipe(F(d=>(this.publicUrl=d.publicUrl,this.uploadService.uploadFileToS3(d.uploadUrl,x))),A(()=>this.isUploading=!1)).subscribe(d=>{d.type===O.UploadProgress?this.uploadProgress=Math.round(100*(d.loaded/d.total)):d.type===O.Response&&(this.uploadedImageUrl=this.publicUrl)})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=E({type:o,selectors:[["app-admin"]],decls:19,vars:15,consts:[["fileInput",""],[1,"admin-container"],[1,"admin-form",3,"formGroup"],["type","select","label","Select Animal","placeholder","Choose an animal","optionValue","id",3,"control","options"],["type","select","label","Select Color","placeholder","Choose a color","optionValue","id",3,"control","options"],["type","select","label","Entity Type","placeholder","Choose entity type","optionValue","value",3,"control","options"],[1,"upload-section"],["icon","pi pi-upload","severity","secondary",3,"onClick","label"],["type","file","accept","image/*",2,"display","none",3,"change"],[3,"onClick","label","disabled","loading"],[4,"ngIf"],["max","100",3,"value"],["alt","Uploaded Image","width","300",3,"src"],["target","_blank",3,"href"],[2,"color","red"]],template:function(e,t){if(e&1){let p=R();a(0,"div",1)(1,"form",2)(2,"h2"),s(3,"Admin Panel"),l(),f(4,"app-form-control",3)(5,"app-form-control",4)(6,"app-form-control",5),l(),a(7,"div",6)(8,"h3"),s(9,"File Upload"),l(),a(10,"p-button",7),C("onClick",function(){u(p);let c=V(12);return g(c.click())}),l(),a(11,"input",8,0),C("change",function(c){return u(p),g(t.onFileSelected(c))}),l(),a(13,"div"),s(14),l(),a(15,"p-button",9),C("onClick",function(){return u(p),g(t.onUpload())}),l(),k(16,Y,3,2,"div",10)(17,Z,8,3,"div",10)(18,ee,3,1,"div",10),l()()}e&2&&(i(),r("formGroup",t.adminForm),i(3),r("control",t.selectedAnimalControl)("options",t.animals()),i(),r("control",t.selectedColorControl)("options",t.colors()),i(),r("control",t.entityTypeControl)("options",t.entityTypeOptions),i(4),r("label","Choose"),i(4),I(t.selectedFile==null?null:t.selectedFile.name),i(),r("label","Upload")("disabled",!t.selectedFile||t.isUploading||t.adminForm.invalid)("loading",t.isUploading),i(),r("ngIf",t.uploadProgress>0),i(),r("ngIf",t.uploadedImageUrl),i(),r("ngIf",t.error))},dependencies:[L,B,z,G,$,Q,K,J],styles:[".admin-container[_ngcontent-%COMP%]{padding:80px 40px 0;display:flex;flex-direction:column;align-items:flex-end;justify-content:flex-start;gap:20px}.admin-container[_ngcontent-%COMP%]   .admin-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:100%;max-width:400px;background:#18181b6b;border:1px solid #dfe7ef;border-radius:8px;padding:40px;box-shadow:0 8px 32px #0000004d}.admin-container[_ngcontent-%COMP%]   .admin-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem;color:#34f5dd}.admin-container[_ngcontent-%COMP%]   .upload-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:100%;max-width:400px;background:#18181b6b;border:1px solid #dfe7ef;border-radius:8px;padding:40px;box-shadow:0 8px 32px #0000004d}.admin-container[_ngcontent-%COMP%]   .upload-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#34f5dd}.admin-container[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{margin-bottom:10px}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;padding:.5rem 1rem;border:none;border-radius:4px;background-color:#007bff;color:#fff;cursor:pointer}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.admin-container[_ngcontent-%COMP%]   progress[_ngcontent-%COMP%]{width:100%;margin-top:10px}.admin-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .admin-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:10px}.admin-container[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;margin-top:10px}@media (max-width: 960px){.admin-container[_ngcontent-%COMP%]{padding:80px 8px 0;align-items:center}}[_nghost-%COMP%]     .p-select.ng-invalid.ng-touched{border:1px solid rgba(255,0,68,.6666666667)!important;border-radius:6px;box-shadow:none}"]})};export{W as AdminComponent};
