import{C as I,Ka as c}from"./chunk-ZXNNLAB3.js";import{A as i,R as s,X as n,a as p,b as u,o as h,s as d,sa as o,tc as a}from"./chunk-QP7WRVZV.js";var l=class r{token=o(null);static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var f=class r{http=n(I);authTokenStateService=n(l);token=a(()=>this.authTokenStateService.token());getUserData(){let e=this.token();if(!e)return h(null);let m=JSON.parse(atob(e.split(".")[1])).username;return this.http.get(`${c.API_URL}/users/${m}`).pipe(i(A=>{throw console.error("Error fetching user data:",A.status),new Error("Failed to fetch user data")}))}getUserId(){return this.getUserData().pipe(d(e=>e?.id||""),i(()=>h("")))}getAnimals(){return this.http.get(`${c.API_URL}/animals`).pipe(i(e=>{throw console.error("Error fetching animals:",e.status),new Error("Failed to fetch animals")}))}getColors(){return this.http.get(`${c.API_URL}/colors`).pipe(i(e=>{throw console.error("Error fetching colors:",e.status),new Error("Failed to fetch colors")}))}getProfileByUserId(e){return this.http.get(`${c.API_URL}/profiles/${e}`).pipe(i(t=>{throw console.error("Error fetching profile by user ID:",t.status),new Error("Failed to fetch profile by user ID")}))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var v="https://wiqes-images.s3.us-east-1.amazonaws.com/0dc7669a-a358-4410-8b3a-3f4510ef0cc6-avatar.png";var b=class r{dataAccessService=n(f);authTokenStateService=n(l);token=a(()=>this.authTokenStateService.token());user=o(null);animals=o([]);isDataLoading=o(!1);tokenProfile=o(null);profile=a(()=>this.user()?.profile||this.tokenProfile());avatarUrl=a(()=>this.profile()?.avatarUrl||v);displayName=a(()=>this.profile()?.name||this.profile()?.email||"");setProfileFromToken(e){if(e){let t=JSON.parse(atob(e.split(".")[1]));this.tokenProfile.set(t.profile||null)}}addAnimalsDataToState(){this.animals()?.length||this.isDataLoading()||(this.isDataLoading.set(!0),this.dataAccessService.getAnimals().subscribe({next:e=>{this.animals.set(e)},error:()=>this.isDataLoading.set(!1),complete:()=>this.isDataLoading.set(!1)}))}addUserDataToState(){this.user()||this.isDataLoading()||(this.isDataLoading.set(!0),this.dataAccessService.getUserData().subscribe({next:e=>{this.user.set(e)},error:()=>this.isDataLoading.set(!1),complete:()=>this.isDataLoading.set(!1)}))}updateUserProfile(e){let t=this.user();if(t&&t.profile){let m=u(p({},t),{profile:p(p({},t.profile),e)});this.user.set(m)}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};export{l as a,f as b,v as c,b as d};
