import{b as W}from"./chunk-VLHTWOTG.js";import"./chunk-SJ5HGQIM.js";import"./chunk-BKVEWL6J.js";import"./chunk-IKPV6XVM.js";import{c as v,f as H,g as z,h as b,j as $,l as B,p as J}from"./chunk-CSDCIWKT.js";import"./chunk-6C2J5BQ3.js";import"./chunk-GGQ7LRWG.js";import"./chunk-APZXJAS2.js";import"./chunk-F2X3VGZZ.js";import{d as K,e as Q}from"./chunk-F6ROZQRG.js";import"./chunk-MAXMR2XW.js";import"./chunk-C4SRROBE.js";import"./chunk-FA5VPBIA.js";import{b as q,c as G}from"./chunk-ZEQNEQPC.js";import{B as O,C as N,Ka as M,m as j}from"./chunk-ZXNNLAB3.js";import{Ab as f,E as A,Eb as R,Ib as C,Jb as h,M as F,Oa as P,R as w,Ra as i,Sb as D,Tb as d,Ub as I,Vb as U,W as T,X as c,cb as k,da as u,ea as g,hb as V,ob as r,sa as E,tc as L,yb as a,zb as l}from"./chunk-QP7WRVZV.js";var y=class o{constructor(t){this.http=t}getPresignedUrl(t){return this.http.post(`${M.API_URL}/uploads/signed-url`,t)}uploadFileToS3(t,e){return this.http.put(t,e,{reportProgress:!0,observe:"events"})}deleteFile(t){let e=encodeURIComponent(t);return this.http.delete(`${M.API_URL}/uploads/${e}`)}static \u0275fac=function(e){return new(e||o)(T(N))};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var S=(e=>(e.MALE="male",e.FEMALE="female",e))(S||{});function Z(o,t){if(o&1&&(a(0,"div"),f(1,"progress",11),d(2),l()),o&2){let e=h();i(),r("value",e.uploadProgress),i(),U(" ",e.uploadProgress,"% ")}}function ee(o,t){if(o&1&&(a(0,"div")(1,"h3"),d(2,"Upload Complete!"),l(),f(3,"img",12),a(4,"p"),d(5," Image URL: "),a(6,"a",13),d(7),l()()()),o&2){let e=h();i(3),r("src",e.uploadedImageUrl,P),i(3),r("href",e.uploadedImageUrl,P),i(),I(e.uploadedImageUrl)}}function te(o,t){if(o&1&&(a(0,"div")(1,"p",14),d(2),l()()),o&2){let e=h();i(2),U("Error: ",e.error,"")}}var X=class o{selectedFile=null;isUploading=!1;uploadProgress=0;uploadedImageUrl=null;publicUrl=null;error=null;stateService=c(G);uploadService=c(y);dataAccessService=c(q);animals=L(()=>this.stateService.animals());colors=E([]);adminForm=new z({selectedAnimal:new b(null,[v.required]),selectedColor:new b(null,[v.required]),entityType:new b(null,[v.required])});get selectedAnimalControl(){return this.adminForm.get("selectedAnimal")}get selectedColorControl(){return this.adminForm.get("selectedColor")}get entityTypeControl(){return this.adminForm.get("entityType")}entityTypeOptions=Object.values(S).map(t=>({name:t.charAt(0).toUpperCase()+t.slice(1),value:t}));ngOnInit(){if(this.dataAccessService.getColors().subscribe(e=>{this.colors.set(e)}),this.stateService.isDataLoading.set(!0),!(this.stateService.animals().length===0)){this.stateService.isDataLoading.set(!1);return}this.dataAccessService.getAnimals().subscribe({next:e=>{this.stateService.addAnimalsDataToState(e)},error:()=>this.stateService.isDataLoading.set(!1),complete:()=>this.stateService.isDataLoading.set(!1)})}onFileSelected(t){let e=t.target;e.files&&e.files[0]&&(this.selectedFile=e.files[0],this.uploadedImageUrl=null,this.uploadProgress=0,this.error=null)}onUpload(){if(!this.selectedFile||this.adminForm.invalid){this.adminForm.markAllAsTouched();return}let t=this.selectedAnimalControl.value,e=this.selectedColorControl.value,n=this.entityTypeControl.value,p=this.animals().find(s=>s.id===t),m=(p?p[n]:[]).find(s=>s.colorId===e)||null;this.isUploading=!0,this.error=null;let x=this.selectedFile;this.uploadService.getPresignedUrl({filename:x.name,contentType:x.type,entityType:n,entityId:m?.id||0}).pipe(F(s=>(this.publicUrl=s.publicUrl,this.uploadService.uploadFileToS3(s.uploadUrl,x))),A(()=>this.isUploading=!1)).subscribe(s=>{s.type===O.UploadProgress?this.uploadProgress=Math.round(100*(s.loaded/s.total)):s.type===O.Response&&(this.uploadedImageUrl=this.publicUrl)})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-admin"]],decls:19,vars:15,consts:[["fileInput",""],[1,"admin-container"],[1,"admin-form",3,"formGroup"],["type","select","label","Select Animal","placeholder","Choose an animal","optionValue","id",3,"control","options"],["type","select","label","Select Color","placeholder","Choose a color","optionValue","id",3,"control","options"],["type","select","label","Entity Type","placeholder","Choose entity type","optionValue","value",3,"control","options"],[1,"upload-section"],["icon","pi pi-upload","severity","secondary",3,"onClick","label"],["type","file","accept","image/*",2,"display","none",3,"change"],[3,"onClick","label","disabled","loading"],[4,"ngIf"],["max","100",3,"value"],["alt","Uploaded Image","width","300",3,"src"],["target","_blank",3,"href"],[2,"color","red"]],template:function(e,n){if(e&1){let p=R();a(0,"div",1)(1,"form",2)(2,"h2"),d(3,"Admin Panel"),l(),f(4,"app-form-control",3)(5,"app-form-control",4)(6,"app-form-control",5),l(),a(7,"div",6)(8,"h3"),d(9,"File Upload"),l(),a(10,"p-button",7),C("onClick",function(){u(p);let m=D(12);return g(m.click())}),l(),a(11,"input",8,0),C("change",function(m){return u(p),g(n.onFileSelected(m))}),l(),a(13,"div"),d(14),l(),a(15,"p-button",9),C("onClick",function(){return u(p),g(n.onUpload())}),l(),V(16,Z,3,2,"div",10)(17,ee,8,3,"div",10)(18,te,3,1,"div",10),l()()}e&2&&(i(),r("formGroup",n.adminForm),i(3),r("control",n.selectedAnimalControl)("options",n.animals()),i(),r("control",n.selectedColorControl)("options",n.colors()),i(),r("control",n.entityTypeControl)("options",n.entityTypeOptions),i(4),r("label","Choose"),i(4),I(n.selectedFile==null?null:n.selectedFile.name),i(),r("label","Upload")("disabled",!n.selectedFile||n.isUploading||n.adminForm.invalid)("loading",n.isUploading),i(),r("ngIf",n.uploadProgress>0),i(),r("ngIf",n.uploadedImageUrl),i(),r("ngIf",n.error))},dependencies:[j,J,$,H,B,W,Q,K],styles:[".admin-container[_ngcontent-%COMP%]{padding:80px 40px 0;display:flex;flex-direction:column;align-items:flex-end;justify-content:flex-start;gap:20px}.admin-container[_ngcontent-%COMP%]   .admin-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:100%;max-width:400px;background:#18181b6b;border:1px solid #dfe7ef;border-radius:8px;padding:40px;box-shadow:0 8px 32px #0000004d}.admin-container[_ngcontent-%COMP%]   .admin-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem;color:#34f5dd}.admin-container[_ngcontent-%COMP%]   .upload-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:100%;max-width:400px;background:#18181b6b;border:1px solid #dfe7ef;border-radius:8px;padding:40px;box-shadow:0 8px 32px #0000004d}.admin-container[_ngcontent-%COMP%]   .upload-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#34f5dd}.admin-container[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{margin-bottom:10px}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;padding:.5rem 1rem;border:none;border-radius:4px;background-color:#007bff;color:#fff;cursor:pointer}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#6c757d;cursor:not-allowed}.admin-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.admin-container[_ngcontent-%COMP%]   progress[_ngcontent-%COMP%]{width:100%;margin-top:10px}.admin-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .admin-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:10px}.admin-container[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:red;margin-top:10px}@media (max-width: 960px){.admin-container[_ngcontent-%COMP%]{padding:80px 8px 0;align-items:center}}[_nghost-%COMP%]     .p-select.ng-invalid.ng-touched{border:1px solid rgba(255,0,68,.6666666667)!important;border-radius:6px;box-shadow:none}"]})};export{X as AdminComponent};
