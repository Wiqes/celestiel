import{a as N,b as B}from"./chunk-EAFCWZ6R.js";import{a as F,c as L}from"./chunk-4NMBWZG3.js";import"./chunk-ATCUZYZW.js";import{a as j}from"./chunk-EASYCPG4.js";import{b as U}from"./chunk-CBKINQOX.js";import{c as E}from"./chunk-D2SEPQ6Z.js";import"./chunk-VJN423GF.js";import{f as z,g as $,h as A}from"./chunk-MHTDVVDV.js";import{f as D}from"./chunk-OIAPHQ4U.js";import{l as k,m as T}from"./chunk-3E3OHC6J.js";import{Bb as i,Cb as a,Db as u,Hb as S,Lb as I,Mb as l,O as x,Ua as r,Wb as s,Xb as _,Yb as f,Z as g,fa as O,fb as b,ga as P,k as v,kb as m,rb as c,tb as w,xb as y,xc as p}from"./chunk-FGD53Q7F.js";function V(n,e){n&1&&(i(0,"div",1),u(1,"app-loader"),a())}function q(n,e){if(n&1&&(i(0,"div",19),s(1),a()),n&2){let t=l().$implicit;r(),_(t.profile.name)}}function G(n,e){if(n&1&&(i(0,"div",20),s(1),a()),n&2){let t=l().$implicit;r(),f(" ",t.unreadCount," ")}}function H(n,e){if(n&1){let t=S();i(0,"div",8),I("click",function(){let h=O(t).$implicit,d=l(2);return P(d.openChat(h.userId))}),i(1,"div",9),u(2,"app-chat-avatar",10)(3,"app-online-status",11),a(),i(4,"div",12)(5,"div",13),m(6,q,2,1,"div",14),i(7,"div",15),s(8),a()(),i(9,"div",16)(10,"span",17),s(11),a(),m(12,G,2,1,"div",18),a()()()}if(n&2){let t=e.$implicit,o=l(2);w("has-unread",t.unreadCount&&t.unreadCount>0),r(2),c("profile",t.profile),r(),c("isOnline",t.isOnline),r(3),c("ngIf",t.profile==null?null:t.profile.name),r(2),f(" ",o.formatLastMessageTime(t.lastMessageAt)," "),r(3),_(t.lastMessage),r(),c("ngIf",t.unreadCount&&t.unreadCount>0)}}function J(n,e){n&1&&(i(0,"div",21)(1,"div",22),s(2,"\u{1F4AC}"),a(),i(3,"h3"),s(4,"No conversations yet"),a(),i(5,"p"),s(6,"Start a new conversation to see it here"),a()())}function K(n,e){if(n&1&&(i(0,"div",2)(1,"h2",3),s(2,"Messages"),a(),i(3,"div",4),s(4),a()(),i(5,"div",5),m(6,H,13,8,"div",6),a(),m(7,J,7,0,"div",7)),n&2){let t=l();r(4),f("",t.interlocutors().length," conversations"),r(2),c("ngForOf",t.interlocutors())("ngForTrackBy",t.trackByFn),r(),c("ngIf",t.interlocutors().length===0)}}var R=class n{chatStateService=g(F);chats=p(()=>this.chatStateService.chats());chatService=g(L);stateService=g(E);router=g(D);destroy$=new v;user=p(()=>this.stateService.user());isChatsLoading=p(()=>this.chatService.isChatsLoading());interlocutors=p(()=>this.chats()?this.chats()?.map(e=>{let t=this.stateService.user()?.id,o=e.participant1Id===Number(t)?e.participant2:e.participant1;return{id:o?.id||"",chatId:e.id,userId:o?.id||"",isOnline:o?.isOnline||!1,profile:o?.profile||null,lastMessageAt:e.lastMessageAt,lastMessage:e.messages[0]?.content||"",unreadCount:this.getUnreadCount(e)}}).sort((e,t)=>{let o=e.lastMessageAt?new Date(e.lastMessageAt).getTime():0;return(t.lastMessageAt?new Date(t.lastMessageAt).getTime():0)-o}):[]);constructor(){this.chatService.onConnect().pipe(x(this.destroy$)).subscribe(()=>{this.connectToUserChats()})}ngOnInit(){this.chatService.isChatsLoading.set(!0),this.chatService.isConnected()&&this.connectToUserChats()}connectToUserChats(){if(this.chats()){this.chatService.isChatsLoading.set(!1);return}this.chatService.getUserChats()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}trackByFn(e,t){return t.chatId}openChat(e){this.router.navigate(["chat",e])}getUnreadCount(e){return this.chatStateService.getUnreadCount(e)}formatLastMessageTime(e){if(!e)return"";let t=new Date,o=new Date(e),h=t.getTime()-o.getTime(),d=Math.floor(h/(1e3*60)),C=Math.floor(d/60),M=Math.floor(C/24);return d<1?"Now":d<60?`${d}m`:C<24?`${C}h`:M<7?`${M}d`:o.toLocaleDateString()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=b({type:n,selectors:[["app-messages"]],decls:3,vars:1,consts:[[1,"messages-container"],[1,"loader-container"],[1,"messages-header"],[1,"messages-title"],[1,"messages-count"],[1,"chat-list"],["class","chat-item","pRipple","",3,"has-unread","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],["pRipple","",1,"chat-item",3,"click"],[1,"avatar-container"],[3,"profile"],[1,"status-indicator",3,"isOnline"],[1,"chat-content"],[1,"chat-header"],["class","chat-name",4,"ngIf"],[1,"chat-time"],[1,"chat-preview"],[1,"last-message"],["class","unread-badge",4,"ngIf"],[1,"chat-name"],[1,"unread-badge"],[1,"empty-state"],[1,"empty-icon"]],template:function(t,o){t&1&&(i(0,"div",0),m(1,V,2,0,"div",1)(2,K,8,4),a()),t&2&&(r(),y(o.isChatsLoading()?1:2))},dependencies:[k,T,U,A,$,z,N,B,j],styles:['.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#ffffff1a;border-radius:3px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#ffffff4d;border-radius:3px}.chat-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#ffffff80}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%], .chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-weight:600}[_nghost-%COMP%]{display:flex;width:100%;justify-content:flex-end}@media (max-width: 800px){[_nghost-%COMP%]{justify-content:center}[_nghost-%COMP%]   .messages-container[_ngcontent-%COMP%]{right:0;max-width:100%}}.messages-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background:#18181bcc;color:#fff;overflow:hidden;position:relative;top:92px;right:2rem;width:320px;border:1px solid rgba(52,245,221,.2);border-radius:1.5rem}.messages-container[_ngcontent-%COMP%]   .loader-container[_ngcontent-%COMP%]{padding:20px}.messages-header[_ngcontent-%COMP%]{padding:1.5rem 1rem 1rem;border-bottom:1px solid rgba(52,245,221,.1);background:linear-gradient(135deg,rgba(52,245,221,.05) 0%,transparent 100%)}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%]{font-size:1.5rem;margin:0 0 .5rem;font-weight:700}.messages-header[_ngcontent-%COMP%]   .messages-count[_ngcontent-%COMP%]{color:#fff9;font-size:.875rem;font-weight:400}.messages-header[_ngcontent-%COMP%]   .messages-count[_ngcontent-%COMP%]   .unread-indicator[_ngcontent-%COMP%]{color:#34f5dd;font-weight:600}.chat-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;max-height:50vh;padding:.5rem 0 1.5rem}.chat-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem;cursor:pointer;transition:all .2s ease-in-out;border-bottom:1px solid rgba(52,245,221,.05);position:relative}.chat-item[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;bottom:0;width:0;background:#34f5dd;transition:width .2s ease-in-out}.chat-item[_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#34f5dd14,#34f5dd08)}.chat-item[_ngcontent-%COMP%]:hover:before{width:3px}.chat-item.has-unread[_ngcontent-%COMP%]{background:linear-gradient(90deg,#34f5dd1f,#34f5dd0d)}.chat-item.has-unread[_ngcontent-%COMP%]:before{width:3px}.chat-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.avatar-container[_ngcontent-%COMP%]{position:relative;flex-shrink:0}.avatar-container[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{position:absolute;bottom:2px;right:2px;z-index:1}.chat-content[_ngcontent-%COMP%]{flex:1;min-width:0;margin-left:14px}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-time[_ngcontent-%COMP%]{color:#ffffff80;font-size:.75rem;font-weight:400;flex-shrink:0}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .last-message[_ngcontent-%COMP%]{color:#ffffffb3;font-size:.875rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;margin-right:.5rem}.chat-content[_ngcontent-%COMP%]   .chat-preview[_ngcontent-%COMP%]   .unread-badge[_ngcontent-%COMP%]{background:#34f5dd;color:#000;font-size:.75rem;font-weight:600;padding:2px 6px;border-radius:10px;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;opacity:.7}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;margin:0 0 .5rem;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff9;margin:0;font-size:.875rem}@media (max-width: 768px){.messages-header[_ngcontent-%COMP%]{padding:1rem .75rem .75rem}.messages-header[_ngcontent-%COMP%]   .messages-title[_ngcontent-%COMP%]{font-size:1.25rem}.chat-item[_ngcontent-%COMP%]{padding:.75rem}.chat-item[_ngcontent-%COMP%]:hover{padding-left:calc(.75rem - 3px)}.chat-content[_ngcontent-%COMP%]   .chat-header[_ngcontent-%COMP%]   .chat-name[_ngcontent-%COMP%]{font-size:.9rem;max-width:65%}}']})};export{R as MessagesComponent};
